(()=>{var e={9306:function(e){!function(t){"use strict";var n=function(){return{escape:function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:t,mimeType:function(e){var n,r;return(n="application/font-woff",r="image/jpeg",{woff:n,woff2:n,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:r,jpeg:r,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[t(e).toLowerCase()]||""},dataAsUrl:function(e,t){return"data:"+t+";base64,"+e},isDataUrl:function(e){return-1!==e.search(/^(data:)/)},canvasToBlob:function(e){return e.toBlob?new Promise((function(t){e.toBlob(t)})):function(e){return new Promise((function(t){for(var n=window.atob(e.toDataURL().split(",")[1]),r=n.length,o=new Uint8Array(r),a=0;a<r;a++)o[a]=n.charCodeAt(a);t(new Blob([o],{type:"image/png"}))}))}(e)},resolveUrl:function(e,t){var n=document.implementation.createHTMLDocument(),r=n.createElement("base");n.head.appendChild(r);var o=n.createElement("a");return n.body.appendChild(o),r.href=t,o.href=e,o.href},getAndEncode:function(e){return s.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime()),new Promise((function(t){var n,r=new XMLHttpRequest;if(r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){var o=new FileReader;o.onloadend=function(){var e=o.result.split(/,/)[1];t(e)},o.readAsDataURL(r.response)}else n?t(n):a("cannot fetch resource: "+e+", status: "+r.status)},r.ontimeout=function(){n?t(n):a("timeout of 30000ms occured while fetching resource: "+e)},r.responseType="blob",r.timeout=3e4,r.open("GET",e,!0),r.send(),s.impl.options.imagePlaceholder){var o=s.impl.options.imagePlaceholder.split(/,/);o&&o[1]&&(n=o[1])}function a(e){console.error(e),t("")}}))},uid:(e=0,function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+e++}),delay:function(e){return function(t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))}},asArray:function(e){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t},escapeXhtml:function(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src=e}))},width:function(e){var t=n(e,"border-left-width"),r=n(e,"border-right-width");return e.scrollWidth+t+r},height:function(e){var t=n(e,"border-top-width"),r=n(e,"border-bottom-width");return e.scrollHeight+t+r}};var e;function t(e){var t=/\.([^\.\/]*?)$/g.exec(e);return t?t[1]:""}function n(e,t){var n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}}(),r=function(){var e=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(e,n,a){return t(e)?Promise.resolve(e).then(r).then((function(t){var r=Promise.resolve(e);return t.forEach((function(e){r=r.then((function(t){return o(t,e,n,a)}))})),r})):Promise.resolve(e)},shouldProcess:t,impl:{readUrls:r,inline:o}};function t(t){return-1!==t.search(e)}function r(t){for(var r,o=[];null!==(r=e.exec(t));)o.push(r[1]);return o.filter((function(e){return!n.isDataUrl(e)}))}function o(e,t,r,o){return Promise.resolve(t).then((function(e){return r?n.resolveUrl(e,r):e})).then(o||n.getAndEncode).then((function(e){return n.dataAsUrl(e,n.mimeType(t))})).then((function(r){return e.replace(function(e){return new RegExp("(url\\(['\"]?)("+n.escape(e)+")(['\"]?\\))","g")}(t),"$1"+r+"$3")}))}}(),o=function(){return{resolveAll:function(){return e(document).then((function(e){return Promise.all(e.map((function(e){return e.resolve()})))})).then((function(e){return e.join("\n")}))},impl:{readAll:e}};function e(){return Promise.resolve(n.asArray(document.styleSheets)).then((function(e){var t=[];return e.forEach((function(e){try{n.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}})),t})).then((function(e){return e.filter((function(e){return e.type===CSSRule.FONT_FACE_RULE})).filter((function(e){return r.shouldProcess(e.style.getPropertyValue("src"))}))})).then((function(t){return t.map(e)}));function e(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return r.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue("src")}}}}}(),a=function(){return{inlineAll:function t(o){return o instanceof Element?function(e){var t=e.style.getPropertyValue("background");return t?r.inlineAll(t).then((function(t){e.style.setProperty("background",t,e.style.getPropertyPriority("background"))})).then((function(){return e})):Promise.resolve(e)}(o).then((function(){return o instanceof HTMLImageElement?e(o).inline():Promise.all(n.asArray(o.childNodes).map((function(e){return t(e)})))})):Promise.resolve(o)},impl:{newImage:e}};function e(e){return{inline:function(t){return n.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||n.getAndEncode).then((function(t){return n.dataAsUrl(t,n.mimeType(e.src))})).then((function(t){return new Promise((function(n,r){e.onload=n,e.onerror=r,e.src=t}))}))}}}}(),i=void 0,c=!1,s={toSvg:l,toPng:function(e,t){return u(e,t||{}).then((function(e){return e.toDataURL()}))},toJpeg:function(e,t){return u(e,t=t||{}).then((function(e){return e.toDataURL("image/jpeg",t.quality||1)}))},toBlob:function(e,t){return u(e,t||{}).then(n.canvasToBlob)},toPixelData:function(e,t){return u(e,t||{}).then((function(t){return t.getContext("2d").getImageData(0,0,n.width(e),n.height(e)).data}))},impl:{fontFaces:o,images:a,util:n,inliner:r,options:{}}};function l(e,t){return function(e){void 0===e.imagePlaceholder?s.impl.options.imagePlaceholder=i:s.impl.options.imagePlaceholder=e.imagePlaceholder,void 0===e.cacheBust?s.impl.options.cacheBust=c:s.impl.options.cacheBust=e.cacheBust}(t=t||{}),Promise.resolve(e).then((function(e){return d(e,t.filter,!0)})).then(f).then(m).then((function(e){return t.bgcolor&&(e.style.backgroundColor=t.bgcolor),t.width&&(e.style.width=t.width+"px"),t.height&&(e.style.height=t.height+"px"),t.style&&Object.keys(t.style).forEach((function(n){e.style[n]=t.style[n]})),e})).then((function(r){return function(e,t,r){return Promise.resolve(e).then((function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(e)})).then(n.escapeXhtml).then((function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"})).then((function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+r+'">'+e+"</svg>"})).then((function(e){return"data:image/svg+xml;charset=utf-8,"+e}))}(r,t.width||n.width(e),t.height||n.height(e))}))}function u(e,t){return l(e,t).then(n.makeImage).then(n.delay(100)).then((function(r){var o=function(e){var r=document.createElement("canvas");if(r.width=t.width||n.width(e),r.height=t.height||n.height(e),t.bgcolor){var o=r.getContext("2d");o.fillStyle=t.bgcolor,o.fillRect(0,0,r.width,r.height)}return r}(e);return o.getContext("2d").drawImage(r,0,0),o}))}function d(e,t,r){return r||!t||t(e)?Promise.resolve(e).then((function(e){return e instanceof HTMLCanvasElement?n.makeImage(e.toDataURL()):e.cloneNode(!1)})).then((function(r){return function(e,t,r){var o=e.childNodes;return 0===o.length?Promise.resolve(t):function(e,t,n){var r=Promise.resolve();return t.forEach((function(t){r=r.then((function(){return d(t,n)})).then((function(t){t&&e.appendChild(t)}))})),r}(t,n.asArray(o),r).then((function(){return t}))}(e,r,t)})).then((function(t){return function(e,t){return t instanceof Element?Promise.resolve().then((function(){r=window.getComputedStyle(e),o=t.style,r.cssText?o.cssText=r.cssText:function(e,t){n.asArray(e).forEach((function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))}))}(r,o);var r,o})).then((function(){[":before",":after"].forEach((function(r){!function(r){var o=window.getComputedStyle(e,r),a=o.getPropertyValue("content");if(""!==a&&"none"!==a){var i=n.uid();t.className=t.className+" "+i;var c=document.createElement("style");c.appendChild(function(e,t,r){var o="."+e+":"+t,a=r.cssText?i(r):c(r);return document.createTextNode(o+"{"+a+"}");function i(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}function c(e){return n.asArray(e).map(t).join("; ")+";";function t(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")}}}(i,r,o)),t.appendChild(c)}}(r)}))})).then((function(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)})).then((function(){t instanceof SVGElement&&(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t instanceof SVGRectElement&&["width","height"].forEach((function(e){var n=t.getAttribute(e);n&&t.style.setProperty(e,n)})))})).then((function(){return t})):t}(e,t)})):Promise.resolve()}function f(e){return o.resolveAll().then((function(t){var n=document.createElement("style");return e.appendChild(n),n.appendChild(document.createTextNode(t)),e}))}function m(e){return a.inlineAll(e).then((function(){return e}))}e.exports=s}()},8642:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDifficultyName=t.DIFFICULTY_CLASSNAME_MAP=t.DIFFICULTIES=void 0,t.DIFFICULTIES=["BASIC","ADVANCED","EXPERT","MASTER","Re:MASTER"],t.DIFFICULTY_CLASSNAME_MAP=new Map([["Re:MASTER","remaster"],["MASTER","master"],["EXPERT","expert"],["ADVANCED","advanced"]]),t.getDifficultyName=function(e){return t.DIFFICULTIES[e]}},271:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateDetailedDxStar=t.getDxStarText=t.determineDxStar=void 0;const n=[0,.85,.9,.93,.95,.97,.99,1];function r(e){for(let t=n.length-1;t>0;t--)if(e>=n[t])return t;return 0}t.determineDxStar=r,t.getDxStarText=function(e,t=!1){return t||e?`✦${e}`:""},t.calculateDetailedDxStar=function(e){const t=e.querySelector(".playlog_result_innerblock .playlog_score_block");if(!t)return 0;const n=t.querySelector(".w_80");if(!n)return;n.remove();const[o,a]=t.textContent.split("/").map((e=>parseInt(e.replace(",","").trim()))),i=o/a,c=r(i),s=`✦${c} (${(100*i).toFixed(1)}%)`,l=document.createElement("div");return l.className="white p_r_5 f_15 f_l",l.append(s),t.prepend(l),c}},8608:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchFriendScores=t.FRIEND_SCORE_URLS=void 0;const o=n(8642),a=n(2347),i=n(6420);t.FRIEND_SCORE_URLS=new Map([[4,"/maimai-mobile/friend/friendGenreVs/battleStart/?scoreType=2&genre=99&diff=4&idx="],[3,"/maimai-mobile/friend/friendGenreVs/battleStart/?scoreType=2&genre=99&diff=3&idx="],[2,"/maimai-mobile/friend/friendGenreVs/battleStart/?scoreType=2&genre=99&diff=2&idx="],[1,"/maimai-mobile/friend/friendGenreVs/battleStart/?scoreType=2&genre=99&diff=1&idx="],[0,"/maimai-mobile/friend/friendGenreVs/battleStart/?scoreType=2&genre=99&diff=0&idx="]]),t.fetchFriendScores=function(e,n,c){return r(this,void 0,void 0,(function*(){let r=t.FRIEND_SCORE_URLS.get(n);if(!r)return;r+=e;const s=(yield(0,i.fetchPage)(r)).querySelectorAll(".main_wrapper.t_c .m_15"),l={genre:"",scoreList:c};s.forEach((e=>function(e,t,n){const r=e.classList.contains("screw_block"),i=e.classList.contains("w_450")&&e.classList.contains("m_15")&&e.classList.contains("p_3")&&e.classList.contains("f_0");if(r)n.genre=e.innerText;else if(i){const r=(0,a.getSongName)(e),i=(0,a.getChartLevel)(e),c=1===(0,a.getChartType)(e)?"DX":"STANDARD",s=function(e){const t=e.querySelector("td.w_120.f_b:last-child"),n=t&&t.innerText.trim();return"0"!==n&&"― %"!==n?n:null}(e);if(!s)return;n.scoreList.push([r,n.genre,(0,o.getDifficultyName)(t),i,c,s].join("\t"))}}(e,n,l)))}))}},2347:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPlayerGrade=t.getPlayerName=t.getChartType=t.getChartDifficulty=t.getChartLevel=t.getSongName=void 0;const r=n(472);t.getSongName=function(e){return(0,r.normalizeSongName)(e.getElementsByClassName("music_name_block")[0].innerText)},t.getChartLevel=function(e){return e.getElementsByClassName("music_lv_block")[0].innerText},t.getChartDifficulty=function(e){if(!e.classList.contains("pointer")){const t=e.querySelector(".pointer");e=t||e}const t=e.className.match(/music_([a-z]+)_score_back/)[1].toUpperCase();return 0===t.indexOf("RE")?"Re:MASTER":t},t.getChartType=function(e){return e.id?e.id.includes("sta_")?0:1:e.querySelector("img:nth-child(2)").src.includes("_standard")?0:1},t.getPlayerName=function(e){var t,n;return e.className.includes("friend_vs_friend_block")?null===(t=e.querySelector(".t_l"))||void 0===t?void 0:t.innerText:null===(n=e.querySelector(".name_block"))||void 0===n?void 0:n.innerText},t.getPlayerGrade=function(e){const t=e.querySelector(".user_data_block_line ~ img.h_25");if(t){const e=t.src.lastIndexOf("grade_");return t.src.substring(e+6,e+8)}return null}},6510:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchScores=t.SELF_SCORE_URLS=void 0;const o=n(8642),a=n(2347),i=n(6420);t.SELF_SCORE_URLS=new Map([[4,"/maimai-mobile/record/musicGenre/search/?genre=99&diff=4"],[3,"/maimai-mobile/record/musicGenre/search/?genre=99&diff=3"],[2,"/maimai-mobile/record/musicGenre/search/?genre=99&diff=2"],[1,"/maimai-mobile/record/musicGenre/search/?genre=99&diff=1"],[0,"/maimai-mobile/record/musicGenre/search/?genre=99&diff=0"]]),t.fetchScores=function(e,n){return r(this,void 0,void 0,(function*(){const r=t.SELF_SCORE_URLS.get(e);if(!r)return;const c=yield(0,i.fetchPage)(r),s=c.querySelectorAll(".main_wrapper.t_c .m_15"),l={genre:"",scoreList:n};return s.forEach((t=>function(e,t,n){const r=e.classList.contains("screw_block"),i=e.classList.contains("w_450")&&e.classList.contains("m_15")&&e.classList.contains("p_r")&&e.classList.contains("f_0");if(r)n.genre=e.innerText;else if(i){const r=(0,a.getSongName)(e),i=(0,a.getChartLevel)(e),c=1===(0,a.getChartType)(e)?"DX":"STANDARD",s=function(e){const t=e.querySelector(".music_score_block.w_120");return t&&t.innerText}(e);if(!s)return;n.scoreList.push([r,n.genre,(0,o.getDifficultyName)(t),i,c,s].join("\t"))}}(t,e,l))),c}))}},134:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVersionName=t.validateGameVersion=t.RATING_CALCULATOR_SUPPORTED_VERSIONS=void 0;const n=["maimai","maimai PLUS","GreeN","GreeN PLUS","ORANGE","ORANGE PLUS","PiNK","PiNK PLUS","MURASAKi","MURASAKi PLUS","MiLK","MiLK PLUS","FiNALE","maimaiでらっくす","maimaiでらっくす PLUS","Splash","Splash PLUS","UNiVERSE","UNiVERSE PLUS","FESTiVAL"];t.RATING_CALCULATOR_SUPPORTED_VERSIONS=[17,18,19],t.validateGameVersion=function(e,t,n=19){const r="string"==typeof e?parseInt(e):e;return!e||isNaN(r)?n:r>=t&&r<=19?r:n},t.getVersionName=function(e){return n[e]}},8080:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInitialLanguage=t.saveLanguage=t.SUPPORTED_LANGUAGES=void 0,t.SUPPORTED_LANGUAGES=["en_US","zh_TW","ko_KR"];const n="MaiToolsLang";t.saveLanguage=function(e){window.localStorage.setItem(n,e)},t.getInitialLanguage=function(){const e=new URLSearchParams(location.search).get("hl");if(e)return e.startsWith("zh")?"zh_TW":e.startsWith("ko")?"ko_KR":"en_US";return function(){switch(window.localStorage.getItem(n)){case"en_US":return"en_US";case"zh_TW":return"zh_TW";case"ko_KR":return"ko_KR"}return null}()||(navigator.language.startsWith("zh")?"zh_TW":navigator.language.startsWith("ko")?"ko_KR":"en_US")}},9268:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultLevel=t.getOfficialLevel=void 0,t.getOfficialLevel=function(e){const t=Math.floor(e);return e-t>.6?t+"+":t.toString()},t.getDefaultLevel=function(e){if(!e)return 1;const t=parseInt(e);return e.endsWith("+")?t+.7:t}},6685:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.writeMagicToCache=t.readMagicFromCache=t.fetchMagic=void 0;const o=n(134),a={13:null,17:"aHR0cHM6Ly9zZ2ltZXJhLmdpdGh1Yi5pby9tYWlfUmF0aW5nQW5hbHl6ZXIvc2NyaXB0c19tYWltYWkvbWFpZHhfaW5fbHZfdW5pdmVyc2UuanM=",18:"aHR0cHM6Ly9naXN0LmdpdGh1YnVzZXJjb250ZW50LmNvbS9teWppYW4vZWU1NjlkNzRmNDIyZDRlMjU1MDY1ZDhiMDJlYTI5NGEvcmF3LzkzMmZiMDNhMzgxMjEyMTAwODBkNmY1Mzc5MTNhMDg0MjQ3ZTUzMWMvbWFpZHhfaW5fbHZfdW5pdmVyc2VwbHVzLmpz",19:"aHR0cHM6Ly9zZ2ltZXJhLmdpdGh1Yi5pby9tYWlfUmF0aW5nQW5hbHl6ZXIvc2NyaXB0c19tYWltYWkvbWFpZHhfaW5fbHZfZmVzdGl2YWwuanM="};function i(e){return"dxLv"+e}t.fetchMagic=function(e){return r(this,void 0,void 0,(function*(){const t=a[e]||a[18],n=yield fetch(atob(t));return yield n.text()}))},t.readMagicFromCache=function(e){const t=i(e),n=window.localStorage.getItem(t);if(console.log('Reading cache for "'+t+'" =>',n),!n)return null;const r=JSON.parse(n),a=new Date(r.date);if((new Date).valueOf()-a.valueOf()>864e5){console.warn('Cache for "'+t+'" is expired.');for(const e of o.RATING_CALCULATOR_SUPPORTED_VERSIONS)window.localStorage.removeItem(i(e));return null}return r.content},t.writeMagicToCache=function(e,t){const n=i(e);console.log('Updating cache for "'+n+'"');const r={date:new Date,content:t};window.localStorage.setItem(n,JSON.stringify(r))}},6991:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeScrollControl=void 0,t.removeScrollControl=function(e){let t=e.getElementById("page-top");t&&t.remove(),t=e.getElementById("page-bottom"),t&&t.remove()}},4468:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.statusText=void 0;const n={zh_TW:{bscStart:"匯入綠譜成績中…",bscDone:"✔",advStart:"匯入黃譜成績中…",advDone:"✔",expStart:"匯入紅譜成績中…",expDone:"✔",masStart:"匯入紫譜成績中…",masDone:"✔",remStart:"匯入白譜成績中…",remDone:"✔"},en_US:{bscStart:"Loading Basic scores…",bscDone:"✔",advStart:"Loading Advanced scores…",advDone:"✔",expStart:"Loading Expert scores…",expDone:"✔",masStart:"Loading Master scores…",masDone:"✔",remStart:"Loading Re:Master scores…",remDone:"✔"},ko_KR:{bscStart:"Basic 정확도 불러오는 중…",bscDone:"✔",advStart:"Advanced 정확도 불러오는 중…",advDone:"✔",expStart:"Expert 정확도 불러오는 중…",expDone:"✔",masStart:"Master 정확도 불러오는 중…",masDone:"✔",remStart:"Re:Master 정확도 불러오는 중…",remDone:"✔"}};t.statusText=function(e,t,r){const o=n[e];switch(t){case 4:return r?o.remDone+"\n":o.remStart;case 3:return r?o.masDone+"\n":o.masStart;case 2:return r?o.expDone+"\n":o.expStart;case 1:return r?o.advDone+"\n":o.advStart;case 0:return r?o.bscDone+"\n":o.bscStart}return""}},4313:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getScriptHost=void 0,t.getScriptHost=function(e){const t=Array.from(document.querySelectorAll("script"));for(;t.length;){const n=t.pop();if(n.src.includes(e)){const e=new URL(n.src),t=e.pathname;return e.origin+t.substring(0,t.lastIndexOf("/scripts"))}}return"https://myjian.github.io/mai-tools"}},472:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.isNicoNicoLink=t.getSongNickname=t.getSongIdx=t.normalizeSongName=t.RATING_TARGET_SONG_NAME_PREFIX=t.DX_SONG_NAME_SUFFIX=void 0;const o=n(6420);t.DX_SONG_NAME_SUFFIX=" [DX]",t.RATING_TARGET_SONG_NAME_PREFIX="▶ ",t.normalizeSongName=function(e){return"D✪N’T  ST✪P  R✪CKIN’"===e?"D✪N’T ST✪P R✪CKIN’":e.replace(/" \+ '/g,"").replace(/' \+ "/g,"")},t.getSongIdx=function(e){return e.getElementsByTagName("form")[0].elements.namedItem("idx").value},t.getSongNickname=function(e,n,r){return"Link"===e&&(e=n.includes("niconico")?"Link(nico)":"Link(org)"),1===r?e+t.DX_SONG_NAME_SUFFIX:e};let a={};t.isNicoNicoLink=function(e){return r(this,void 0,void 0,(function*(){if(a.nico===e)return!0;if(a.original===e)return!1;const t=(yield(0,o.fetchPage)("/maimai-mobile/record/musicDetail/?"+new URLSearchParams([["idx",e]]).toString())).body.querySelector(".m_10.m_t_5.t_r.f_12").innerText.includes("niconico");return console.log("Link (idx: "+e+") "+(t?"is niconico":"is original")),t?a.nico=e:a.original=e,t}))}},87:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSongsByVersion=t.filterSongsByVersion=t.getSongProperties=t.buildSongPropsMap=void 0;const r=n(8642),o=n(472),a=/\bdx\s*:\s*([0-9]+)/,i=/\blv\s*:\s*(\[.+?\])/,c=/\bv\s*:\s*(-?[0-9]+)/,s=/\bn\s*:\s*["'](.+?)['"]\s*[,\}]/,l=/\bnn\s*:\s*["'](.+?)['"]\s*[,\}]/,u=[{name:"宿星審判",dx:1,debut:16,lv:[-4,-8,-12,14.4,0]}],d=new Map([[19,[{name:"39",dx:1,lv:[NaN,NaN,NaN,12.8]},{name:"ヒステリックナイトガール",dx:1,lv:[NaN,NaN,NaN,12.8]},{name:"MOBILYS",dx:1,lv:[NaN,NaN,NaN,13.1]},{name:"マトリョシカ",dx:0,lv:[NaN,NaN,NaN,NaN,13.2]},{name:"宿星審判",dx:1,lv:[NaN,NaN,NaN,14.3]}]]]);function f(e){const t=e.match(a),n=e.match(i),u=e.match(c),d=e.match(s),f=e.match(l);if(t&&n&&u&&d){let e=JSON.parse(n[1]);if(e.length>r.DIFFICULTIES.length){const t=e.pop();e[r.DIFFICULTIES.length-1]=t}return{dx:parseInt(t[1]),lv:e,debut:Math.abs(parseInt(u[1])),name:(0,o.normalizeSongName)(d[1]),nickname:f&&f[1]}}}function m(e,t){if(!e.has(t.name))return!1;const n=e.get(t.name),r=n.findIndex((e=>t.dx===e.dx));return!(r<0||(n[r]=function(e,t){let n=e.lv;return t.lv instanceof Array&&(n=e.lv.map(((e,n)=>isNaN(t.lv[n])?e:t.lv[n]))),Object.assign(Object.assign(Object.assign({},e),t),{lv:n})}(n[r],t),0))}function p(e,t){m(e,t)||(e.has(t.name)||e.set(t.name,[]),e.get(t.name).push(t))}t.buildSongPropsMap=function(e,t,n){const r=n.split("\n"),o=new Map;for(const e of r){const t=f(e);t&&p(o,t)}if(0===t)for(const e of u)p(o,e);const a=d.get(e);if(a)for(const e of a)m(o,e);return o},t.getSongProperties=function(e,t,n,r){let a=e.get(t);if(a&&a.length>0){if(a.length>1&&(a=a.filter((e=>e.dx===r)),a.length>1)){const e=(0,o.getSongNickname)(t,n,r);a=a.filter((t=>t.nickname===e))}if(a.length)return a.length>1&&(console.warn(`Found multiple song properties for ${t} ${r}`),console.warn(a)),a[0]}console.warn(`Could not find song properties for ${t} ${r}`)},t.filterSongsByVersion=function(e,t,n,r){const o=[];for(const a of e){const{dx:e,name:i,nickname:c}=a;let s=t.get(i);s&&s.length>0&&(s.length>1&&(s=s.filter((t=>t.dx===e)),s.length>1&&(s=s.filter((e=>e.nickname===c)))),s.length)?(s.length>1&&(console.warn(`Found multiple song properties for ${i} ${e?"[DX]":""}`),console.warn(s)),(0===r&&s[0].debut===n||1===r&&s[0].debut<n)&&o.push(s[0])):console.warn(`Could not find song properties for ${i} ${e?"[DX]":""}`)}return o},t.getSongsByVersion=function(e,t){const n=[];return e.forEach((e=>e.forEach((e=>{e.debut===t&&n.push(e)})))),n}},6420:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getPostMessageFunc=t.fetchNewSongs=t.fetchAllSongs=t.fetchGameVersion=t.fetchPage=t.handleError=t.ALLOWED_ORIGINS=void 0;const o=n(2347),a=n(6510),i=n(472);function c(e){return r(this,void 0,void 0,(function*(){const t=yield fetch(e),n=yield t.text();return(new DOMParser).parseFromString(n,"text/html")}))}function s(e){return r(this,void 0,void 0,(function*(){const t=Array.from(e.querySelectorAll(".w_450.m_15.f_0")),n=[];for(const e of t){const t=(0,i.getSongIdx)(e),r=(0,o.getSongName)(e),a=(0,o.getChartType)(e);let c;"Link"===r&&(c=(yield(0,i.isNicoNicoLink)(t))?"Link(nico)":"Link(org)"),n.push({dx:a,name:r,nickname:c})}return n}))}t.ALLOWED_ORIGINS=["https://cdpn.io","https://myjian.github.io","http://localhost:8080"],t.handleError=function(e){alert(e)},t.fetchPage=c,t.fetchGameVersion=function e(t){return r(this,void 0,void 0,(function*(){const n=t.querySelector("select[name=version] option:last-of-type");return n?parseInt(n.value):e(t=yield c("/maimai-mobile/record/musicVersion/"))}))},t.fetchAllSongs=function(e){return r(this,void 0,void 0,(function*(){if(!e){const t=a.SELF_SCORE_URLS.get(1);e=yield c(t)}return yield s(e)}))},t.fetchNewSongs=function(e){return r(this,void 0,void 0,(function*(){const t=yield c(`/maimai-mobile/record/musicVersion/search/?version=${e}&diff=0`);return yield s(t)}))},t.getPostMessageFunc=function(e,t){return(n,r)=>{const o={action:n,payload:r};e.postMessage(o,t)}}},9475:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.albumDownloadHelper=void 0,t.albumDownloadHelper=function(e){const t=/music_(\w+)_score_back/,r=6e4*(540+(new Date).getTimezoneOffset());function o(e,t){return t=t||2,e.toString().padStart(t,"0")}function a(e){return e.getFullYear()+"-"+o(e.getMonth()+1)+"-"+o(e.getDate())+" "+o(e.getHours())+"-"+o(e.getMinutes())}function i(e){const n=function(e){const t=e.getElementsByClassName("block_info")[0].innerText.match(/(\d+)\/(\d+)\/(\d+) (\d+):(\d+)/),n=new Date(parseInt(t[1]),parseInt(t[2])-1,parseInt(t[3]),parseInt(t[4]),parseInt(t[5]));return new Date(n.valueOf()-r)}(e),o=e.getElementsByClassName("black_block")[0].innerText.replace(/<>:"\/\\\|\?\*/g,"-"),i=e.className.match(t);return i?`${a(n)} ${o} ${i[1].toUpperCase()}.jpg`:`${a(n)} ${o}.jpg`}function c(e){return n(this,void 0,void 0,(function*(){const t=e.querySelector("img.w_430");return fetch(t.src).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))}))}function s(t,n,r){const o=t.getElementsByClassName("black_block")[0];if(o.getElementsByTagName("a").length)return;const a=e.createElement("a");a.download=r,a.href=n,a.target="_blank",o.append(a),a.append(o.childNodes[0]," ","💾")}!function(){n(this,void 0,void 0,(function*(){e.body.oncontextmenu=null;const t=Array.from(e.getElementsByClassName("black_block")).map((e=>e.parentElement));for(const e of t)s(e,yield c(e),i(e))}))}()}},6898:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.analyzeFriendRatingInNewTab=void 0;const o=n(8608),a=n(2347),i=n(8080),c=n(4468),s=n(4313),l=n(6420);t.analyzeFriendRatingInNewTab=function(e){const t=(0,s.getScriptHost)("analyze-friend-rating-in-new-tab")+"/rating-calculator/?";let n=(0,i.getInitialLanguage)();const u={zh_TW:{pleaseLogIn:"請登入 maimai NET",analyze:"分析 Rating"},en_US:{pleaseLogIn:"Please log in to maimai DX NET.",analyze:"Analyze Rating"},ko_KR:{pleaseLogIn:"maimai DX NET에 로그인 해 주세요.",analyze:"레이팅 분석하기"}}[n],d={};function f(n,r){let o=(2===n.page?document:r).querySelector(".analyzeLink");o&&(2===n.page?o.parentElement:o).remove(),o=e.createElement("a"),o.className="analyzeLink f_14",o.style.color="#1477e6",o.target="friendRating",o.innerText=u.analyze;const a=new URLSearchParams({friendIdx:n.idx,playerName:n.name});if(o.href=t+a.toString(),2===n.page){o.className+=" d_ib friend_comment_block t_c",o.style.borderRadius="5px",o.style.width="184px",o.style.marginRight="15px";const e=document.createElement("div");e.className="m_l_10 m_r_10 t_r",e.append(o),r.parentElement.insertAdjacentElement("afterend",e)}else o.className+=" d_b",r.querySelector(0===n.page?".friend_comment_block":".comment_block").insertAdjacentElement("afterbegin",o)}!function(){const t=location.host;if("maimaidx-eng.com"!==t&&"maimaidx.jp"!==t)return void(0,l.handleError)(u.pleaseLogIn);if(location.pathname.includes("/friendLevelVs/")||location.pathname.includes("/friendGenreVs/")){const e=document.querySelector(".friend_vs_friend_block"),t=new URLSearchParams(location.search).get("idx"),n={idx:t,name:(0,a.getPlayerName)(e),grade:"",page:2};d[t]=n,f(n,e)}else if(location.pathname.includes("/friend/friendDetail/")){const e=document.querySelector(".see_through_block"),t=new URLSearchParams(location.search).get("idx"),n={idx:t,name:(0,a.getPlayerName)(e),grade:(0,a.getPlayerGrade)(e),page:1};d[t]=n,f(n,e)}else Array.from(e.querySelectorAll("img.friend_favorite_icon")).map((e=>e.parentElement)).forEach((e=>{const t=e.querySelector("[name=idx]").value,n={idx:t,name:(0,a.getPlayerName)(e),grade:(0,a.getPlayerGrade)(e),page:0};d[t]=n,f(n,e)}));let s;const m=(0,l.fetchGameVersion)(document.body);window.ratingCalcMsgListener&&window.removeEventListener("message",window.ratingCalcMsgListener),window.ratingCalcMsgListener=e=>r(this,void 0,void 0,(function*(){if(console.log(e.origin,e.data),l.ALLOWED_ORIGINS.includes(e.origin)){const t=(0,l.getPostMessageFunc)(e.source,e.origin);if("object"!=typeof e.data)return;if("getFriendRecords"===e.data.action){t("gameVersion",yield m);const a=d[e.data.payload];a&&function(e,t){r(this,void 0,void 0,(function*(){e.grade&&t("playerGrade",e.grade);const r=[];for(const a of o.FRIEND_SCORE_URLS.keys())t("appendPlayerScore",(0,c.statusText)(n,a,!1)),yield(0,o.fetchFriendScores)(e.idx,a,r),t("appendPlayerScore",(0,c.statusText)(n,a,!0));t("replacePlayerScore",""),t("appendPlayerScore",r.join("\n")),t("calculateRating","")}))}(a,t)}else if("fetchNewSongs"===e.data.action){const n=yield m,r=e.data.payload;n<r?t("newSongs",[]):(0,l.fetchNewSongs)(r).then((e=>t("newSongs",e)))}else"fetchAllSongs"===e.data.action?(s&&t("allSongs",s),(0,l.fetchAllSongs)().then((e=>{s=e,t("allSongs",e)}))):"saveLanguage"===e.data.action&&(n=e.data.payload,(0,i.saveLanguage)(n))}})),window.addEventListener("message",window.ratingCalcMsgListener)}()}},7552:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.analyzeRatingInNewTab=void 0;const o=n(2347),a=n(6510),i=n(8080),c=n(4468),s=n(4313),l=n(6420);t.analyzeRatingInNewTab=function(){const e=(0,s.getScriptHost)("analyze-rating-in-newtab")+"/rating-calculator/";let t=(0,i.getInitialLanguage)();const n={zh_TW:{pleaseLogIn:"請登入 maimai NET",analyze:"分析 Rating"},en_US:{pleaseLogIn:"Please log in to maimai DX NET.",analyze:"Analyze Rating"},ko_KR:{pleaseLogIn:"maimai DX NET에 로그인 해 주세요.",analyze:"레이팅 분석하기"}},u=location.pathname.includes("friend");function d(e){return r(this,void 0,void 0,(function*(){let n;const r=u?null:(0,o.getPlayerGrade)(document.body);r&&e("playerGrade",r);const i=[];for(const r of a.SELF_SCORE_URLS.keys()){e("appendPlayerScore",(0,c.statusText)(t,r,!1));const o=yield(0,a.fetchScores)(r,i);3===r&&(n=o),e("appendPlayerScore",(0,c.statusText)(t,r,!0))}return e("replacePlayerScore",""),e("appendPlayerScore",i.join("\n")),e("calculateRating",""),n}))}!function(){const a=location.host;if("maimaidx-eng.com"!==a&&"maimaidx.jp"!==a)return void(0,l.handleError)(n[t].pleaseLogIn);const c=u?null:(0,o.getPlayerName)(document.body);!function(e){const r=document.body.querySelector(".basic_block.p_10.f_0");if(!r)return;let o=document.querySelector(".analyzeLink");o&&o.remove(),o=document.createElement("a"),o.className="analyzeLink f_14",o.style.color="#1477e6",o.target="selfRating",o.append(n[t].analyze,document.createElement("br")),o.href=e,location.pathname.indexOf("/maimai-mobile/playerData/")>=0?(o.className+=" f_l",document.querySelector(".m_5.m_t_10.t_r.f_12").insertAdjacentElement("afterbegin",o)):location.pathname.indexOf("/maimai-mobile/home/")>=0?(o.className+=" d_b",document.querySelector(".comment_block.f_l.f_12").insertAdjacentElement("afterbegin",o)):r.querySelector(".name_block").parentElement.append(o)}(c?e+"?"+new URLSearchParams({playerName:c}):e);const s=(0,l.fetchGameVersion)(document.body);let f;window.ratingCalcMsgListener&&window.removeEventListener("message",window.ratingCalcMsgListener),window.ratingCalcMsgListener=e=>r(this,void 0,void 0,(function*(){if(console.log(e.origin,e.data),l.ALLOWED_ORIGINS.includes(e.origin)){const n=(0,l.getPostMessageFunc)(e.source,e.origin);if("string"==typeof e.data)"ready"===e.data&&(n("gameVersion",yield s),f=d(n));else if("object"==typeof e.data)if("ready"===e.data.action)n("gameVersion",yield s),"string"==typeof e.data.payload&&(t=e.data.payload),f=d(n);else if("fetchNewSongs"===e.data.action){const t=yield s,r=e.data.payload;t<r?n("newSongs",[]):(0,l.fetchNewSongs)(r).then((e=>n("newSongs",e)))}else"fetchAllSongs"===e.data.action?f.then((e=>(0,l.fetchAllSongs)(e).then((e=>n("allSongs",e))))):"saveLanguage"===e.data.action&&(t=e.data.payload,(0,i.saveLanguage)(t))}})),window.addEventListener("message",window.ratingCalcMsgListener)}()}},396:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.recentPlayDownloader=void 0;const a=n(8642),i=n(271),c=n(8080),s=n(6991),l=n(4313),u=o(n(9306));t.recentPlayDownloader=function(e){const t={zh_TW:{date:"日期",songName:"歌曲",difficulty:"難度",achievement:"達成率",stamps:"成就",playDate:"遊玩日期：",newRecordToggleHeading:"顯示：",sortBy:"排序方式：",newRecordsOnly:"只顯示新高分紀錄",allRecords:"全部",olderFirst:"由舊到新",newerFirst:"由新到舊",copy:"複製",copied:"已複製到剪貼簿",downloadAsImage:"存成圖片"},en_US:{date:"Date",songName:"Song",difficulty:"Difficulty",achievement:"Achv",stamps:"Grade",playDate:"Play date:",newRecordToggleHeading:"Display:",sortBy:"Sort by:",newRecordsOnly:"New records only",allRecords:"All",olderFirst:"Older first",newerFirst:"Newer first",copy:"Copy",copied:"Copied to clipboard",downloadAsImage:"Save as image"},ko_KR:{date:"날짜",songName:"노래",difficulty:"난이도",achievement:"정확도",stamps:"등급",playDate:"플레이 일:",newRecordToggleHeading:"표시:",sortBy:"정렬 순서:",newRecordsOnly:"새 기록만",allRecords:"전부",olderFirst:"옛날 기록부터",newerFirst:"최근 기록부터",copy:"복사",copied:"클립보드에 복사되었습니다",downloadAsImage:"이미지로 저장하기"}}[(0,c.getInitialLanguage)()],n=new Map([["fc","FC"],["fcplus","FC+"],["ap","AP"],["applus","AP+"]]),o=new Map([["fs","FS"],["fsplus","FS+"],["fsd","FSD"],["fsdplus","FSD+"]]),d="newRecordRadio",f="sortByRadio",m="recordRow",p=["dateCell","songTitleCell","difficultyCell","achievementCell","stampsCell"],g=(0,l.getScriptHost)("recent-play-downloader"),h=e.createElement.bind(e),y=6e4*(540+(new Date).getTimezoneOffset());function S(e,t){return t=t||2,e.toString().padStart(t,"0")}function _(e){const t=e.querySelector(".sub_title").children[1].innerText.match(/(\d+)\/(\d+)\/(\d+) (\d+):(\d+)/),n=new Date(parseInt(t[1]),parseInt(t[2])-1,parseInt(t[3]),parseInt(t[4]),parseInt(t[5]));return new Date(n.valueOf()-y)}function v(e){try{return e.querySelector(".m_5.p_5.f_13").textContent}catch(t){return console.log(t),console.log(e),""}}function b(e){const t=e.querySelector(".music_img");return t?t.src:""}function w(e){const t=e.children[1].className;let n=t.substring(t.indexOf("_")+1,t.lastIndexOf("_"));return n="remaster"===n?"Re:MASTER":n.toUpperCase(),e.querySelector(".playlog_music_kind_icon").src.endsWith("music_dx.png")?"DX "+n:n}function x(e){return parseFloat(e.querySelector(".playlog_achievement_txt").innerText)}function L(e){const t=e.querySelector("img.playlog_scorerank").src.replace(/\?ver=.*$/,"");let r=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")).replace("plus","+").toUpperCase();const a=e.querySelectorAll(".playlog_result_innerblock > img"),c=a[0].src.replace(/\?ver=.*$/,""),s=c.substring(c.lastIndexOf("/")+1,c.lastIndexOf("."));n.has(s)&&(r+=" / "+n.get(s));const l=a[1].src.replace(/\?ver=.*$/,""),u=l.substring(l.lastIndexOf("/")+1,l.lastIndexOf("."));o.has(u)&&(r+=" / "+o.get(u));const d=function(e){const t=(0,i.calculateDetailedDxStar)(e);return(0,i.getDxStarText)(t)}(e);return d&&(r+=" / "+d),r}function N(e){return!!e.querySelector(".playlog_achievement_label_block + img.playlog_achievement_newrecord")}function E(e){return e.getFullYear()+"-"+S(e.getMonth()+1)+"-"+S(e.getDate())+" "+S(e.getHours())+":"+S(e.getMinutes())}function A(e,t,n){const r=h("tr");for(const e of t)r.classList.add(e);return e.forEach(((e,t)=>{const o=h(n?"th":"td");"string"==typeof e?o.append(e):(e[1]&&(o.classList.add("songImg"),o.style.backgroundImage=`url("${e[1]}")`),o.append(e[0])),o.classList.add("recordCell"),o.classList.add(p[t]),r.append(o)})),r}function D(e,n,r,o){r.innerHTML="",o.innerHTML="",r.append(A([t.date,t.songName,t.difficulty,t.achievement,t.stamps],[m],!0)),e.forEach((e=>{o.append(function(e){const t=e.difficulty.split(" ").pop();return A([E(e.date),[e.songName,e.songImgSrc],e.difficulty,e.achievement.toFixed(4)+"%",e.stamps],[m,a.DIFFICULTY_CLASSNAME_MAP.get(t)],!1)}(e))})),n.style.paddingBottom=Math.floor(e.length/2)+2+"px"}function I(){const t=e.querySelectorAll("input.dateCheckbox"),n=new Set;return t.forEach((e=>{e.checked&&n.add(e.value)})),n}function T(e,t){let n=[].concat(e);if(console.log(t),t.dates&&(n=n.filter((e=>t.dates.has(E(e.date).split(" ")[0])))),!t.showAll){const e=new Map;n.forEach((t=>{if(t.isNewRecord){const n=t.difficulty+" "+t.songName;e.delete(n),e.set(n,t)}})),n=[],e.forEach((e=>{n.push(e)}))}return t.olderFirst||n.reverse(),n}function P(n,r){const o=n.reduce(((e,t)=>(e.add(E(t.date).split(" ")[0]),e)),new Set);let a=e.getElementById("recordSummary");a?a.innerHTML="":(a=h("div"),a.id="recordSummary");const i=h("div");i.className="playRecordContainer";const c=h("table"),s=h("thead"),l=h("tbody");c.className="playRecordTable",c.append(s,l),i.append(c);const m=()=>{D(T(n,function(){const t=I();let n=!1;e.getElementsByName(d).forEach((e=>{e.checked&&(n="allRecords"===e.value)}));let r=!0;return e.getElementsByName(f).forEach((e=>{e.checked&&(r="olderFirst"===e.value)})),{dates:t,showAll:n,olderFirst:r}}()),i,s,l)};a.append(function(e,n){const r=h("div");r.className="m_b_10 dateOptionsContainer";const o=h("div");return o.className="t_c m_5",o.append(t.playDate),r.append(o),e.forEach((e=>{const t=h("label");t.className="f_14 dateOptionLabel";const o=h("input");o.type="checkbox",o.className="dateCheckbox",o.value=e,o.checked=!0,o.addEventListener("change",n),t.append(o,e),r.append(t)})),r}(o,m)),a.append(function(e){const n=h("div");n.className="m_b_10 newRecordToggleContainer";const r=h("div");return r.className="t_c m_5",r.append(t.newRecordToggleHeading),n.append(r),["newRecordsOnly","allRecords"].forEach(((r,o)=>{const a=h("label");a.className="f_14 newRecordLabel";const i=h("input");i.type="radio",i.name=d,i.className=d,i.value=r,i.checked=0===o,i.addEventListener("change",e),a.append(i,t[r]),n.append(a)})),n}(m)),a.append(function(e){const n=h("div");n.className="m_b_10 sortByRadioContainer";const r=h("div");return r.className="t_c m_5",r.append(t.sortBy),n.append(r),["newerFirst","olderFirst"].forEach(((r,o)=>{const a=h("label");a.className="f_14 sortByLabel";const i=h("input");i.type="radio",i.name=f,i.className=f,i.value=r,i.checked=0===o,i.addEventListener("change",e),a.append(i,t[r]),n.append(a)})),n}(m));const p=function(n){const r=h("div");r.className="copyBtnContainer";const o=h("button");o.className="copyBtn",o.append(t.copy),r.append(o);let a=e.querySelector(".snackbarContainer"),i=e.querySelector(".snackbar");a||(a=h("div"),a.className="snackbarContainer",a.style.display="none",e.body.append(a)),i||(i=h("div"),i.className="wrapper snackbar",i.innerText=t.copied,a.append(i)),o.addEventListener("click",(t=>{(()=>{const t=window.getSelection(),n=e.createRange();n.selectNodeContents(l),t.removeAllRanges(),t.addRange(n)})(),e.execCommand("copy"),a.style.display="block",i.style.opacity="1",setTimeout((()=>{i.style.opacity="0",setTimeout((()=>{a.style.display="none"}),500)}),4e3)}));const c=h("button");return c.className="downloadImgBtn",c.append(t.downloadAsImage),c.addEventListener("click",(()=>{const t=e.querySelector(".playRecordContainer");u.default.toPng(t).then((e=>{const t="record_"+Array.from(I()).join(",")+".png",n=h("a");n.href=e,n.download=t,n.click()}))})),r.append(c),r}();a.append(p),D(T(n,{olderFirst:!1}),i,s,l),a.append(i),r.insertAdjacentElement("beforebegin",a)}const R=e.querySelector(".main_wrapper > img.title");if(R){const t="recentPlayStyles";if(!e.getElementById(t)){const n=h("link");n.id=t,n.rel="stylesheet",n.href=g+"/scripts/recent-play-downloader.css",n.addEventListener("load",(()=>{(0,s.removeScrollControl)(e),function(){return r(this,void 0,void 0,(function*(){const t=Array.from(e.querySelectorAll(".main_wrapper .p_10.t_l.f_0.v_b")),n=[];for(const e of t)n.push({date:_(e),songName:v(e),songImgSrc:b(e),difficulty:w(e),achievement:x(e),stamps:L(e),isNewRecord:N(e)});return n.reverse(),n}))}().then((e=>{P(e,R)})).catch((t=>{const n=e.getElementsByTagName("footer")[0],r=h("textarea");n.append(r),r.value=t.message+"\n"+t.stack}))})),e.head.append(n)}}}},6286:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scoreConverter=void 0;const r=n(271),o=n(8080),a=n(6991),i=n(4313),c=n(6420);t.scoreConverter=function(e){const t={en_US:{analyzeScore:"🔍 CLICK ME TO ANALYZE SCORE"},zh_TW:{analyzeScore:"🔍 點我分析分數"},ko_KR:{analyzeScore:"🔍 정확도 분석하기"}}[(0,o.getInitialLanguage)()],n=(0,i.getScriptHost)("score-converter")+"/classic-layout/",s=new Map([["S","/maimai-mobile/maimai-img/icon_s.png"],["S+","/maimai-mobile/maimai-img/icon_s_plus.png"],["SS","/maimai-mobile/maimai-img/icon_ss.png"],["SS+","/maimai-mobile/maimai-img/icon_ss_plus.png"],["SSS","/maimai-mobile/maimai-img/icon_sss.png"],["SSS+","/maimai-mobile/maimai-img/icon_sss_plus.png"]]),l=new Map([["AAA","/maimai-mobile/img/music_icon_aaa.png"],["AA","/maimai-mobile/img/music_icon_aa.png"],["A","/maimai-mobile/img/music_icon_a.png"]]),u=new Map([["fc","/maimai-mobile/maimai-img/icon_fc_silver.png"],["fcplus","/maimai-mobile/maimai-img/icon_fc_gold.png"],["ap","/maimai-mobile/maimai-img/icon_ap.png"]]),d=new Map([["applus","/maimai-mobile/img/music_icon_app.png"]]),f=new Map([["FS","/maimai-mobile/maimai-img/icon_maxfever_silver.png"],["FS+","/maimai-mobile/maimai-img/icon_maxfever_gold.png"]]),m=new Map([["FDX","/maimai-mobile/img/music_icon_fsd.png"],["FDX+","/maimai-mobile/img/music_icon_fsdp.png"]]);function p(e){return e.trim().replace(/\s+/g,"-")}function g(e,t){return t=t||2,e.toString().padStart(t,"0")}function h(e,t){let n=e.get(t);return n instanceof Blob?Promise.resolve(n):n?fetch(n).then((e=>e.blob())).then((n=>(e.set(t,n),n))):void 0}function y(e){return e.querySelector(".basic_block.break").childNodes[1].nodeValue}function S(e){const t=e.querySelector(".playlog_achievement_txt").innerText;return t.substring(0,t.length-1)}function _(e){return e.querySelector(".playlog_notes_detail").innerText.split("\n").slice(-5).map(p).join("_")}function v(e){const t=e.querySelector(".playlog_top_container img.playlog_diff").src,n=t.substring(t.lastIndexOf("_")+1,t.lastIndexOf("."));return"remaster"===n?"Re:MASTER":n.toUpperCase()}function b(e){const t=e.querySelector(".playlog_top_container .sub_title span:last-child").innerText.match(/(\d+)\/(\d+)\/(\d+) (\d+):(\d+)/),n=new Date(parseInt(t[1]),parseInt(t[2])-1,parseInt(t[3]),parseInt(t[4]),parseInt(t[5]));return(r=new Date(n.valueOf()-36e5)).getFullYear()+"-"+g(r.getMonth()+1)+"-"+g(r.getDate())+" "+g(r.getHours())+":"+g(r.getMinutes());var r}function w(e){return e.querySelector(".playlog_achievement_newrecord")?1:0}function x(e){return e.querySelector(".col2 .playlog_score_block .white").innerText}function L(t){const n=t.querySelector("img.music_img"),r=e.createElement("canvas");return r.width=n.width,r.height=n.height,r.getContext("2d").drawImage(n,0,0,r.width,r.height),r.toDataURL()}function N(e){return h(s,e)||h(l,e)||Promise.reject('invalid title "'+e+'"')}function E(e){const t=e.querySelector(".playlog_result_innerblock > img:nth-child(3)").src;switch(t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."))){case"fs":return"FS";case"fsplus":return"FS+";case"fsd":return"FDX";case"fsdplus":return"FDX+"}return null}"maimaidx-eng.com"!==e.location.host&&"maimaidx.jp"!==e.location.host||!e.location.pathname.includes("/maimai-mobile/record/playlogDetail/")||(function(){(0,a.removeScrollControl)(e);const r=new URLSearchParams({dt:b(e.body),tk:(o=e.body,o.querySelector(".playlog_top_container .sub_title .f_b").innerText.replace("0","")),st:y(e.body),df:v(e.body),ac:S(e.body),hs:w(e.body).toString(),nd:_(e.body),cb:x(e.body)});var o;let i=n+"?"+r.toString();const s=E(e.body);s&&(i+="&sc="+encodeURIComponent(s)),console.log(i),console.log("url length: "+i.length),function(n){let r=e.getElementById("placeName");r||(r=function(){const t=e.createElement("div");t.className="basic_block m_10 p_l_10 t_l f_14 break";const n=e.createElement("span");n.className="m_t_5 p_5 d_ib";const r=e.createElement("div");return r.className="clearfix",t.append(n,r),e.querySelector(".gray_block").insertAdjacentElement("afterend",t),t}());const o=e.getElementById("placeNameCtrl");o&&o.remove();const a=r.querySelector("span");if(a.parentElement instanceof HTMLAnchorElement)return;a.innerText=t.analyzeScore;const i=e.createElement("a");i.href=n,i.target="classic_layout",i.className="blue d_ib",i.style.height="40px",r.append(i),i.append(a)}(i),window.addEventListener("message",(t=>{if(c.ALLOWED_ORIGINS.includes(t.origin)){const r=t.data,o=t.source;let a="";switch(r.action){case"ready":o.postMessage({action:"songImage",imgSrc:L(e.body)},t.origin),function(e){const t=e.querySelector(".playlog_result_innerblock > img:nth-child(2)").src.replace(/\?ver=.*$/,""),n=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));return"fc_dummy"===n?Promise.resolve(null):h(u,n)||h(d,n)||Promise.reject('invalid title "'+n+'"')}(e.body).then((e=>{e&&o.postMessage({action:"apFcImage",img:e},t.origin)})),(n=E(e.body),n?h(f,n)||h(m,n)||Promise.reject('invalid title "'+n+'"'):Promise.resolve(null)).then((e=>{e&&o.postMessage({action:"syncImage",img:e},t.origin)})),a=function(e){const t=e.querySelector(".playlog_scorerank").src.replace(/\?ver=.*$/,"");return t.substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")).toUpperCase().replace("PLUS","+")}(e.body),N(a).then((e=>{o.postMessage({action:"rankImage",title:a,img:e},t.origin)}));break;case"getRankImage":a=r.payload,N(a).then((e=>{o.postMessage({action:"rankImage",title:a,img:e},t.origin)}))}}var n}))}(),(0,r.calculateDetailedDxStar)(e.body))}},7913:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.scoreDownload=void 0;const o=n(6510),a=n(8080),i=n(4468),c=n(6420);t.scoreDownload=function(){const e=(0,a.getInitialLanguage)(),t={zh_TW:{pleaseLogIn:"請登入 maimai NET",fetch:"下載所有成績",copy:"複製成績",copied:"已複製到剪貼簿",allDone:"✅ 已匯入全部成績到文字框，請按「複製成績」把資料複製到剪貼簿。複製後可於 Excel 或 Google 試算表內貼上。"},en_US:{pleaseLogIn:"Please log in to maimai DX NET.",fetch:"Load all scores",copy:"Copy",copied:"Copied to clipboard",allDone:'✅ All scores are loaded into text box. Click "Copy" to copy scores to clipboard. You can paste it in Excel or Google Sheets.'},ko_KR:{pleaseLogIn:"maimai DX NET에 로그인 해 주세요.",fetch:"모든 기록 불러오기",copy:"복사",copied:"클립보드에 복사되었습니다",allDone:'✅ 모든 기록이 로드되었습니다. "복사"를 눌러 클립보드로 복사하고 엑셀이나 구글 시트에 붙여 넣으세요.'}}[e];function n(n){n.preventDefault(),function(n){r(this,void 0,void 0,(function*(){const r=location.host;if("maimaidx-eng.com"!==r&&"maimaidx.jp"!==r)return void n(t.pleaseLogIn);const a=document.getElementById("outputText"),c=[];for(const t of o.SELF_SCORE_URLS.keys())a.value+=(0,i.statusText)(e,t,!1)+"\n",yield(0,o.fetchScores)(t,c);a.value=c.join("\n"),document.querySelector(".fetchStatus").innerText=t.allDone}))}(c.handleError)}!function(e){const r=document.createElement("div");r.id="outputArea",r.style.position="relative",r.style.marginBottom="16px";const o=document.createElement("textarea");o.className="f_10",o.id="outputText",r.append(o);const a=document.createElement("button");a.className="m_r_5",a.style.color="#1477e6",a.append(t.fetch),a.addEventListener("click",n);const i=document.createElement("button");i.innerText=t.copy;for(let e of[a,i])e.style.backgroundColor="#9f51dc",e.style.border="2px solid black",e.style.borderRadius="5px",e.style.color="white",e.style.fontWeight="700",e.style.padding="8px 12px";r.append(a,i),i.addEventListener("click",(()=>{o.select(),i.disabled=!0,i.style.cursor="default",i.style.filter="grayscale(1.0)",document.execCommand("copy"),i.innerText=t.copied,setTimeout((()=>{i.disabled=!1,i.style.cursor="",i.style.filter="",i.innerText=t.copy}),3e3)}));const c=document.createElement("div");c.className="fetchStatus f_16 m_t_10",c.style.fontWeight="700",c.style.color="white",c.style.textShadow="1px 1px 2px black",r.append(c),e.insertAdjacentElement("afterend",r)}(document.querySelector(".see_through_block"))}},3153:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.scoreSort=void 0;const o=n(8642),a=n(2347),i=n(6510),c=n(8080),s=n(9268),l=n(6685),u=n(472),d=n(87),f=n(6420);t.scoreSort=function(e){const t={en_US:{None:"-- Choose Sort Option --",RankAsc:"Rank (low → high)",RankDes:"Rank (high → low)",ApFcAsc:"AP/FC (FC → AP+)",ApFcDes:"AP/FC (AP+ → FC)",SyncAsc:"Sync (FS → FDX+)",SyncDes:"Sync (FDX+ → FS)",VsResultAsc:"VS Result (Lose → Win)",VsResultDes:"VS Result (Win → Lose)",LvAsc:"Level (low → high)",LvDes:"Level (high → low)",InLvAsc:"Internal Level (low → high)",InLvDes:"Internal Level (high → low)",DxStarDes:"DX-Star (7 → none)",DxStarAsc:"DX-Star (none → 7)"},zh_TW:{None:"-- 選擇排序方式 --",RankAsc:"達成率 (由低至高)",RankDes:"達成率 (由高至低)",ApFcAsc:"AP/FC (由 FC 到 AP+)",ApFcDes:"AP/FC (由 AP+ 到 FC)",SyncAsc:"Sync (由 FS 到 FDX+)",SyncDes:"Sync (由 FDX+ 到 FS)",VsResultAsc:"對戰結果 (由敗北到勝利)",VsResultDes:"對戰結果 (由勝利到敗北)",LvAsc:"譜面等級 (由低至高)",LvDes:"譜面等級 (由高至低)",InLvAsc:"內部譜面等級 (由低至高)",InLvDes:"內部譜面等級 (由高至低)",DxStarDes:"DX-Star (7 星至無星)",DxStarAsc:"DX-Star (無星至 7 星)"},ko_KR:{None:"-- 정렬 순서를 선택해주세요 --",RankAsc:"정확도 오름차순 (낮음 → 높음)",RankDes:"정확도 내림차순 (높음 → 낮음)",ApFcAsc:"AP/FC 오름차순 (FC → AP+)",ApFcDes:"AP/FC 내림차순 (AP+ → FC)",SyncAsc:"Sync 오름차순 (FS → FDX+)",SyncDes:"Sync 내림차순 (FDX+ → FS)",VsResultAsc:"VS 결과 오름차순 (Lose → Win)",VsResultDes:"VS 결과 내림차순 (Win → Lose)",LvAsc:"난이도 오름차순 (낮음 → 높음)",LvDes:"난이도 내림차순 (높음 → 낮음)",InLvAsc:"난이도 상수 오름차순 (낮음 → 높음)",InLvDes:"난이도 상수 내림차순 (높음 → 낮음)",DxStarDes:"DX-Star 내림차순 (7 → none)",DxStarAsc:"DX-Star 오름차순 (none → 7)"}}[(0,c.getInitialLanguage)()],n=["1","2","3","4","5","6","7","7+","8","8+","9","9+","10","10+","11","11+","12","12+","13","13+","14","14+","15"],m=["SSS+","SSS","SS+","SS","S+","S","AAA","AA","A","BBB","BB","B","C","D",null],p=["AP+","AP","FC+","FC",null],g=["FDX+","FDX","FS+","FS",null],h=["WIN","DRAW","LOSE"],y=[null,"✦ - 85%","✦✦ - 90%","✦✦✦ - 93%","✦✦✦✦ - 95%","✦✦✦✦✦ - 97%","✦6 - 99%","✦7 - 100%"],S=location.pathname.includes("battleStart"),_=location.search.includes("scoreType=1"),v={};function b(e){const t=e-Math.floor(e);return t>.95?1:t>.65&&t<.69?.7:0}function w(e){const t=b(e);return t?t<1?"UNKNOWN LEVEL "+Math.floor(e)+"+":"UNKNOWN LEVEL "+e.toFixed(0):"INTERNAL LEVEL "+e.toFixed(1)}function x(e,t){const n=new Map;t&&e.reverse();for(const t of e)n.set(t,[]);return t&&e.reverse(),n}function L(t,n,r){let o=[];return t.forEach(((t,a)=>{if(t.length){const i=e.createElement("div");i.className="screw_block m_15 f_15",i.innerText=function(e,t,n,r){let o=3===e?"":"◖";switch(e){case 1:o+="LEVEL "+t;break;case 2:o+=t?"RANK "+t:"NO RANK";break;default:o+=t||" ― "}return 3!==e&&(o+="◗"),o+"　　　"+n+"/"+r}(n,a,t.length,r),o.push(i),o=o.concat(t)}})),o}function N(e){return e.getElementsByClassName("music_lv_block")[0]}function E(e,t="lv"){var n;return null===(n=N(e))||void 0===n?void 0:n.dataset[t]}function A(e,t){const n=N(e);if(!n.dataset.inlv){const e=b(t);n.dataset.inlv=t.toFixed(2);const r=(e?"*":"")+t.toFixed(1);r.length>4&&(n.classList.remove("f_14"),n.classList.add("f_13")),n.innerText=r}}function D(e,t,n){let r=0;return n&&(r=n.lv[t],"number"!=typeof r?r=0:r<0&&(r=Math.abs(r)-.02)),r||(0,s.getDefaultLevel)(E(e))-.02}function I(e,t){const n=E(e,"inlv");if(n)return parseFloat(n);const r=(0,a.getSongName)(e),i=(0,a.getChartType)(e),c=o.DIFFICULTIES.indexOf((0,a.getChartDifficulty)(e));let s;if("Link"===r){const n=S?null:(0,u.getSongIdx)(e);v.nicoLinkIdx===n?s=(0,d.getSongProperties)(t,r,"niconico",i):v.originalLinkIdx===n&&(s=(0,d.getSongProperties)(t,r,"",i)),console.log(s)}else s=(0,d.getSongProperties)(t,r,"",i);return D(e,c,s)}function T(e,t){const n=I(e,v.songProps),r=I(t,v.songProps);return n<r?-1:r<n?1:0}function P(e,t){const r=x(n,t);return e.forEach((e=>{const t=E(e);r.get(t).push(e)})),v.songProps&&r.forEach((e=>{e.sort(T),t&&e.reverse()})),L(r,1,e.length)}function R(e){const t=S?e.querySelector("tr:last-child td:last-child img:last-child"):e.children[0].querySelector("img.f_r:not(.music_kind_icon):last-of-type");if(!t)return null;const n=new URL(t.src).pathname,r=n.substring(n.lastIndexOf("_")+1,n.lastIndexOf("."));return"back"===r?null:r.replace("p","+").toUpperCase()}function k(e){const t=S?e.querySelector("tr:first-child td:last-child"):e.querySelector(".music_score_block.w_120");return t?parseFloat(t.innerText):t}function C(e,t){const n=k(e),r=k(t);return null===n&&null===r?0:null===r?-1:null===n?1:n>r?-1:n<r?1:0}function M(e,t){const n=x(m,t);return e.forEach((e=>{const t=R(e);try{n.get(t).push(e)}catch(r){console.warn(t),n.get(null).push(e)}})),_||n.forEach(((e,n)=>{e.sort(C),null!==n&&t&&e.reverse()})),L(n,2,e.length)}function F(e){const t=S?e.querySelector("tr:last-child td:last-child img:nth-child(2)"):e.children[0].querySelector("img.f_r:nth-last-of-type(2)");if(!t)return null;const n=t.src.replace(/\?ver=.*$/,""),r=n.lastIndexOf("_"),o=n.lastIndexOf("."),a=n.substring(r+1,o);return"back"===a?null:a.replace("ap","AP").replace("p","+").toUpperCase()}function O(e,t){const n=x(p,t);return e.forEach((e=>{const t=F(e);n.get(t).push(e)})),L(n,0,e.length)}function U(e){const t=S?e.querySelector("tr:last-child td:last-child img:first-child"):e.children[0].querySelector("img.f_r:nth-last-of-type(3)");if(!t)return null;const n=t.src.replace(/\?ver=.*$/,""),r=n.lastIndexOf("_"),o=n.lastIndexOf("."),a=n.substring(r+1,o);return"back"===a?null:a.replace("sd","DX").replace("p","+").toUpperCase()}function q(e,t){const n=x(g,t);return e.forEach((e=>{const t=U(e);n.get(t).push(e)})),L(n,0,e.length)}function j(e,t){const n=x(h,t);return e.forEach((e=>{const t=function(e){const t=e.querySelector("tr:first-child td:nth-child(2) img").src.replace(/\?ver=.*$/,""),n=t.lastIndexOf("_"),r=t.lastIndexOf(".");return t.substring(n+1,r).toUpperCase()}(e);n.get(t).push(e)})),L(n,0,e.length)}function $(e){if(S){const t=e.querySelector("tr:first-child td:last-child img");if(!t)return null;const n=new URL(t.src).pathname,r=n.substring(n.lastIndexOf("_")+1,n.lastIndexOf("."));try{const e=parseInt(r);return(e<0||e>=y.length)&&console.warn("invalid dx star "+r),y[e]}catch(e){console.warn("invalid dx star "+r)}return null}if(e.dataset.dxStar)return"null"===e.dataset.dxStar?null:e.dataset.dxStar;const t=function(e){const t=e.querySelectorAll(".music_score_block");if(2!==t.length)return null;const n=t[1].childNodes,r=n[n.length-1];if(!r.wholeText)return null;const o=r.wholeText.split("/");if(2!==o.length)return null;try{const e=parseInt(o[0].replace(",","").trim()),t=parseInt(o[1].replace(",","").trim()),n=e/t;if(e===t)return y[7];if(n>=.99)return y[6];if(n>=.97)return y[5];if(n>=.95)return y[4];if(n>=.93)return y[3];if(n>=.9)return y[2];if(n>=.85)return y[1]}catch(e){console.warn(e)}return null}(e);return e.dataset.dxStar=t,t}function V(e,t){const n=x(y,t);return e.forEach((e=>{const t=$(e);n.get(t).push(e)})),L(n,3,e.length)}function H(e,t){const n=new Map,r=[];for(const t of Array.from(e)){const e=I(t,v.songProps);n.set(e,!0),r.push(e)}const o=Array.from(n.keys()).sort(((e,t)=>e>t?-1:e<t?1:0));t&&o.reverse();const a=new Map;return o.forEach((e=>{a.set(w(e),[])})),Array.from(e).forEach(((e,t)=>{a.get(w(r[t])).push(e)})),L(a,0,e.length)}function z(){return e.body.querySelectorAll(".main_wrapper.t_c .w_450.m_15.f_0")}function B(n,r){const o=t[n];let a=e.getElementsByClassName("option_"+n)[0];return a||(a=e.createElement("option"),a.className="option_"+n,a.innerText=o,a.value=n),r?a.classList.add("d_n"):a.classList.remove("d_n"),a}S?function(){var t,n;r(this,void 0,void 0,(function*(){const r=yield(0,f.fetchPage)(i.SELF_SCORE_URLS.get(4)),o=null===(t=r.querySelector(".music_scorelist_table"))||void 0===t?void 0:t.parentElement;if(!o)return void console.warn("could not find summary table");_||null===(n=o.querySelector("tr:last-child"))||void 0===n||n.remove();const a=z(),c=a.length;setTimeout((function(){const e={};for(const t of m)e[t]=0;a.forEach((t=>{e[R(t)]++}));for(let t=1;t<9;t++)e[m[t]]+=e[m[t-1]];const t=o.querySelectorAll("tr:first-child .f_10");t[0].innerHTML=`${e.A}/${c}`,t[1].innerHTML=`${e.S}/${c}`,t[2].innerHTML=`${e["S+"]}/${c}`,t[3].innerHTML=`${e.SS}/${c}`,t[4].innerHTML=`${e["SS+"]}/${c}`,t[5].innerHTML=`${e.SSS}/${c}`,t[6].innerHTML=`${e["SSS+"]}/${c}`}),0),setTimeout((function(){const e={};for(const t of p)e[t]=0;a.forEach((t=>{e[F(t)]++}));for(let t=1;t<4;t++)e[p[t]]+=e[p[t-1]];const t=o.querySelectorAll("tr:nth-child(2) .f_10");t[0].innerHTML=`${e.FC}/${c}`,t[1].innerHTML=`${e["FC+"]}/${c}`,t[2].innerHTML=`${e.AP}/${c}`,t[3].innerHTML=`${e["AP+"]}/${c}`}),0),setTimeout((function(){const e={};for(const t of g)e[t]=0;a.forEach((t=>{e[U(t)]++}));for(let t=1;t<4;t++)e[g[t]]+=e[g[t-1]];const t=o.querySelectorAll("tr:nth-child(2) .f_10");t[4].innerHTML=`${e.FS}/${c}`,t[5].innerHTML=`${e["FS+"]}/${c}`,t[6].innerHTML=`${e.FDX}/${c}`,t[7].innerHTML=`${e["FDX+"]}/${c}`}),0),_&&setTimeout((function(){const e={};for(const t of y)e[t]=0;a.forEach((t=>{e[$(t)]++}));for(let t=y.length-2;t>=1;t--)e[y[t]]+=e[y[t+1]];const t=o.querySelectorAll("tr:last-child .f_10");t[0].innerHTML=`${e[y[1]]}/${c}`,t[1].innerHTML=`${e[y[2]]}/${c}`,t[2].innerHTML=`${e[y[3]]}/${c}`,t[3].innerHTML=`${e[y[4]]}/${c}`,t[4].innerHTML=`${e[y[5]]}/${c}`}),0),e.querySelector(".town_block + .see_through_block").insertAdjacentElement("afterend",o)}))}():e.querySelectorAll("div.w_450.m_15.p_r.f_0[id]").forEach((e=>{var t,n;e.style.removeProperty("display"),e.style.removeProperty("margin-top"),e.id.includes("sta_")?null===(t=e.querySelector(".music_kind_icon_dx"))||void 0===t||t.remove():null===(n=e.querySelector(".music_kind_icon_standard"))||void 0===n||n.remove();const r=e.querySelector("img:nth-child(2)");r.onclick=null,r.className="music_kind_icon"})),Array.from(e.getElementsByClassName("music_lv_block")).forEach((e=>{e.dataset.lv||(e.dataset.lv=e.innerText)}));const G=e.body.querySelector(".main_wrapper.t_c .screw_block");G&&(G.insertAdjacentElement("beforebegin",function(){const t="scoreSortContainer";let n=e.getElementById(t);if(n)return n;n=e.createElement("div"),n.id=t,n.className="w_450 m_15";const r=e.createElement("select");return r.className="w_300 m_10",r.addEventListener("change",(t=>{!function(t){const n=z(),r=Array.from(e.body.querySelectorAll(".main_wrapper.t_c .screw_block"));let o=null;switch(t){case"RankDes":o=M(n,!1);break;case"RankAsc":o=M(n,!0);break;case"ApFcDes":o=O(n,!1);break;case"ApFcAsc":o=O(n,!0);break;case"SyncDes":o=q(n,!1);break;case"SyncAsc":o=q(n,!0);break;case"VsResultAsc":o=j(n,!0);break;case"VsResultDes":o=j(n,!1);break;case"LvDes":o=P(n,!0);break;case"LvAsc":o=P(n,!1);break;case"InLvDes":o=H(n,!1);break;case"InLvAsc":o=H(n,!0);break;case"DxStarAsc":o=V(n,!1);break;case"DxStarDes":o=V(n,!0);break;default:return}for(let e=1;e<r.length;e++)r[e].remove();const a=r[0];for(let e=o.length-1;e>=1;e--)a.insertAdjacentElement("afterend",o[e]);a.innerText=o[0].innerText}(t.target.value)})),r.append(B("None")),r.append(B("RankAsc")),r.append(B("RankDes")),r.append(B("ApFcAsc")),r.append(B("ApFcDes")),r.append(B("SyncAsc")),r.append(B("SyncDes")),S?(_&&(r.append(B("DxStarDes")),r.append(B("DxStarAsc"))),r.append(B("VsResultAsc")),r.append(B("VsResultDes"))):(r.append(B("DxStarDes")),r.append(B("DxStarAsc"))),r.append(B("LvAsc")),r.append(B("LvDes")),r.append(B("InLvAsc",!0)),r.append(B("InLvDes",!0)),n.append(r),n}()),function(){r(this,void 0,void 0,(function*(){const t=yield(0,f.fetchGameVersion)(e.body),n="maimaidx.jp"===window.location.host?1:0,r=(0,d.buildSongPropsMap)(t,n,yield(0,l.fetchMagic)(t)),i=Array.from(z());for(const e of i){const t=(0,a.getSongName)(e);if("Link"===t){const n=o.DIFFICULTIES.indexOf((0,a.getChartDifficulty)(e));try{const o=(0,u.getSongIdx)(e);let a;(yield(0,u.isNicoNicoLink)(o))?(v.nicoLinkIdx=o,a=(0,d.getSongProperties)(r,t,"niconico",0)):(v.originalLinkIdx=o,a=(0,d.getSongProperties)(r,t,"",0)),A(e,D(e,n,a))}catch(t){A(e,D(e,n))}}else A(e,I(e,r))}console.log("enabling internal level sort"),B("InLvAsc",!1),B("InLvDes",!1),v.songProps=r}))}())}},8383:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.songDetailHelper=void 0;const o=n(271),a=n(6420),i=n(87),c=n(6685),s=n(472),l=n(9268);t.songDetailHelper=function(e){const t={};function n(e,t){if(!e.dataset.inlv){const n=function(e){const t=e-Math.floor(e);return t>.95?1:t>.65&&t<.69?.7:0}(t);e.dataset.inlv=t.toFixed(2),e.innerText=(n?"*":"")+t.toFixed(1)}}function u(e,t,n){let r=0;return n&&(r=n.lv[t],"number"!=typeof r?r=0:r<0&&(r=Math.abs(r)-.02)),r||(0,l.getDefaultLevel)(function(e,t="lv"){return e.dataset[t]}(e))-.02}function d(e){return e.querySelector(".music_lv_back")}e.querySelectorAll(".music_score_block.w_310").forEach((function(t){const n=t.querySelector("img.f_l");if(!n)return;n.remove();const[r,a]=t.textContent.split("/").map((e=>parseInt(e.replace(",","").trim()))),i=r/a,c=(0,o.getDxStarText)((0,o.determineDxStar)(i),!0)+` (${(100*i).toFixed(1)}%)`,s=e.createElement("div");s.className="f_l",s.append(c),t.prepend(s)})),function(){r(this,void 0,void 0,(function*(){const r=yield(0,a.fetchGameVersion)(e.body),o="maimaidx.jp"===window.location.host?1:0,l=(0,i.buildSongPropsMap)(r,o,yield(0,c.fetchMagic)(r)),f=(0,s.normalizeSongName)(document.querySelector(".m_5.f_15.break").textContent),m=e.querySelector(".f_l.h_20").src.includes("_standard")?0:1,p=(0,i.getSongProperties)(l,f,"",m);t.songProp=p,Array.from(e.querySelectorAll(".music_detail_table tr"),((e,t)=>{const r=d(e);r&&n(r,u(r,t,p))})),["basic","advanced","expert","master","remaster"].forEach(((t,r)=>{const o=e.querySelector(`#${t}`);if(!o)return;const a=d(o);n(a,u(a,r,p))}))}))}()}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}(()=>{"use strict";const e=n(6991),t=n(7552),r=n(7913),o=n(3153),a=n(9475),i=n(6898),c=n(8383),s=n(6286),l=n(396);!function(n){if(["maimaidx-eng.com","maimaidx.jp"].indexOf(n.location.host)<0)return;const u=n.location.pathname;"/maimai-mobile/record/"===u?(0,l.recentPlayDownloader)(n):u.indexOf("/maimai-mobile/record/playlogDetail/")>=0?(0,s.scoreConverter)(n):u.indexOf("/maimai-mobile/record/musicDetail/")>=0?((0,e.removeScrollControl)(n),(0,c.songDetailHelper)(n)):u.indexOf("/maimai-mobile/record/music")>=0?(0,o.scoreSort)(n):u.indexOf("/maimai-mobile/friend/")>=0?((0,t.analyzeRatingInNewTab)(),(0,i.analyzeFriendRatingInNewTab)(n),(u.indexOf("/maimai-mobile/friend/friendGenreVs/battleStart/")>=0||u.indexOf("/maimai-mobile/friend/friendLevelVs/battleStart/")>=0)&&(0,o.scoreSort)(n)):u.indexOf("/maimai-mobile/home/")>=0||u.indexOf("/maimai-mobile/playerData/")>=0?((0,e.removeScrollControl)(n),(0,r.scoreDownload)(),(0,t.analyzeRatingInNewTab)()):u.indexOf("/maimai-mobile/photo/")>=0&&(0,a.albumDownloadHelper)(n)}(document)})()})();