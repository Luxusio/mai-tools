(()=>{"use strict";var e={7980:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculateAchvLoss=void 0;const n=a(6358),r=a(1782);function o(){return Object.assign({total:0},r.EMPTY_JUDGEMENT_OBJ)}t.calculateAchvLoss=function(e,t,a){const s=o(),c=o(),l={dx:new Map,finale:new Map},i=(0,n.sum)(Object.values(e.get("break")));return e.forEach(((e,n)=>{const u=r.BASE_SCORE_PER_TYPE[n],d=o(),m=o();if("break"===n)d.perfect=50*t.get(2550)+100*t.get(2500),d.great=600*t.get(2e3)+1100*t.get(1500)+1350*t.get(1250),d.good=1600*t.get(1e3),d.miss=2600*t.get(0),d.total=Object.values(d).reduce(((e,t)=>e+t),0),m.perfect=(t.get(2550)*(1-r.BREAK_BONUS_MULTIPLIER.get(2550))+t.get(2500)*(1-r.BREAK_BONUS_MULTIPLIER.get(2500)))/i,m.great=(t.get(2e3)*(1-r.BREAK_BASE_SCORE_MULTIPLIER.get(2e3))+t.get(1500)*(1-r.BREAK_BASE_SCORE_MULTIPLIER.get(1500))+t.get(1250)*(1-r.BREAK_BASE_SCORE_MULTIPLIER.get(1250)))*u/a+(t.get(2e3)*(1-r.BREAK_BONUS_MULTIPLIER.get(2e3))+t.get(1500)*(1-r.BREAK_BONUS_MULTIPLIER.get(1500))+t.get(1250)*(1-r.BREAK_BONUS_MULTIPLIER.get(1250)))/i,m.good=t.get(1e3)*(1-r.BREAK_BASE_SCORE_MULTIPLIER.get(1e3))*u/a+t.get(1e3)*(1-r.BREAK_BONUS_MULTIPLIER.get(1e3))/i,m.miss=t.get(0)*u/a+t.get(0)/i,m.total=Object.values(m).reduce(((e,t)=>e+t),0);else{d.perfect=0,d.great=Math.round(e.great*u*(1-r.REGULAR_BASE_SCORE_MULTIPLIER.great)),d.good=Math.round(e.good*u*(1-r.REGULAR_BASE_SCORE_MULTIPLIER.good)),d.miss=e.miss*u,d.total=Object.values(d).reduce(((e,t)=>e+t),0);for(const[e,t]of Object.entries(d))m[e]=t/a}for(const[e,t]of Object.entries(d))c[e]+=t;for(const[e,t]of Object.entries(m))s[e]+=t;l.finale.set(n,d),l.dx.set(n,m)})),l.finale.set("total",c),l.dx.set("total",s),l}},7616:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.walkBreakDistributions=void 0;const n=a(1782);t.walkBreakDistributions=function e(t,a,r,o,s){let c=r[0],l=!1,i=0;switch(r.length){case 5:return a.set(n.MAX_BREAK_POINTS,c),e(t,a,r.slice(1),o,s);case 4:let u=0,d=c;if(a.has(n.MAX_BREAK_POINTS)){const e=a.get(n.MAX_BREAK_POINTS);c+=e,u=e,d=e}for(let m=d;m>=u;m--){a.set(n.MAX_BREAK_POINTS,m);for(let n=c-m;n>=0;n--){a.set(2550,n),a.set(2500,c-m-n);const u=e(t,a,r.slice(1),o,s);if(l||(i=u,l=!0),u<o)break}}return i;case 3:for(let n=c;n>=0;n--){a.set(2e3,n);for(let u=c-n;u>=0;u--){a.set(1500,u),a.set(1250,c-n-u);const d=e(t,a,r.slice(1),o,s);if(l||(i=d,l=!0),d<o)break}}return i;case 2:return a.set(1e3,c),e(t,a,r.slice(1),o,s);case 1:return a.set(0,c),e(t,a,r.slice(1),o,s);case 0:let m=0,f=0,g=0;return a.forEach(((e,t)=>{m+=e,g+=e*n.BREAK_BASE_SCORE_MULTIPLIER.get(t)*s,f+=e*n.BREAK_BONUS_MULTIPLIER.get(t)})),g+=f/m,o-=g,Math.abs(o)<1e-4&&t.push(new Map(a)),g;default:throw new Error("unreachable")}}},7889:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AchievementInfo=void 0;const r=n(a(7363)),o=a(7991);function s(e,t,a,n){return t?(0,o.getRankTitle)(a):"AP+"===n?"SSS+":(0,o.getFinaleRankTitle)(e)}function c(e){const t="apfc";return e?"FC+"===e?"apfc fcplus":e.includes("AP")?"apfc ap":t:t}function l(e){return e?"sync":"sync finaleSync"}class i extends r.default.PureComponent{static getDerivedStateFromProps(e){const{dxAchv:t,apFcStatus:a,finaleAchv:n,isDxMode:r}=e;return{rankTitle:s(n,r,t,a)}}componentDidMount(){this.fetchRankImage()}componentDidUpdate(){this.fetchRankImage()}render(){const{apFcStatus:e,apFcImg:t,rankImgMap:a,isHighScore:n,syncStatus:o,syncImg:s,maxFinaleAchv:i,dxAchv:u,finaleAchv:d,isDxMode:m,toggleDisplayMode:f,showMaxAchv:g}=this.props,{rankTitle:p}=this.state,E=a.get(p),h=E?r.default.createElement("img",{className:"rankImg",src:E,alt:p}):p,_=t?r.default.createElement("img",{className:"apFcImg",src:t,alt:e}):e,S=s?r.default.createElement("img",{className:"syncImg",src:s,alt:o}):this.getSyncStatusText(o,m),M=m?u.toFixed(4):d.toFixed(2),v=m?101..toFixed(4):i.toFixed(2);return r.default.createElement("div",{className:"achievementInfo"},r.default.createElement("div",{className:"achvInfoSpace"}),r.default.createElement("div",{className:"rank"},h),r.default.createElement("div",{className:c(e)},_),r.default.createElement("div",{className:l(m)},S),r.default.createElement("div",{className:"playerScore"},r.default.createElement("div",{className:"highScore"},n?"HIGH SCORE!!":" "),r.default.createElement("button",{className:"achievement",onClick:f},"達成率：",r.default.createElement("span",{className:"achvNum"+(g?" hasMaxAchv":"")},r.default.createElement("span",{className:"playerAchv"},M,"％"),g&&r.default.createElement("span",{className:"maxAchv"},v,"％")))))}getSyncStatusText(e,t){if(e&&!t)switch(e){case"FS":case"FS+":return"MAX FEVER";case"FDX":case"FDX+":return"100% SYNC"}return e}fetchRankImage(){const{rankImgMap:e,fetchRankImage:t}=this.props,{rankTitle:a}=this.state;e.has(a)||t(a)}}t.AchievementInfo=i},5188:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BreakNoteJudgement=void 0;const r=n(a(7363)),o=a(3526);class s extends r.default.PureComponent{render(){const{judgements:e,distribution:t,lastColumn:a,isDxMode:n,displayMode:s}=this.props,c=a.isMax?"score maxScore":"score";return"DETAIL"===s?r.default.createElement("tr",{className:"breakNoteRow"},r.default.createElement("th",{className:"rowHead"},"Break"),r.default.createElement("td",{colSpan:3,className:"noRightBorder"},r.default.createElement("div",{className:"breakDistribution"},r.default.createElement("span",{className:"perfect"},t.get(2600)),r.default.createElement("span",{className:"perfect"},t.get(2550)),r.default.createElement("span",{className:"perfect"},t.get(2500)),r.default.createElement("span",{className:"great"},t.get(2e3)),r.default.createElement("span",{className:"great"},t.get(1500)),r.default.createElement("span",{className:"great"},t.get(1250)),r.default.createElement("span",{className:"good"},t.get(1e3)))),r.default.createElement("td",{className:"noLeftBorder"},r.default.createElement("div",{className:"miss missWithBefore"},t.get(0))),r.default.createElement("td",{className:c},(0,o.getLastColumnText)(a.score,n))):r.default.createElement(o.NoteJudgement,{noteType:"break",judgements:e,lastColumn:a,isDxMode:n})}}t.BreakNoteJudgement=s},5748:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CreditInfo=void 0;const r=n(a(7363));class o extends r.default.PureComponent{render(){return r.default.createElement("div",{className:"credit"},r.default.createElement("span",{className:"madeBy"},"Made by "),r.default.createElement("a",{className:"authorLink",href:"https://github.com/myjian",target:"_blank"},"myjian"),".")}}t.CreditInfo=o},8625:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DateAndPlace=void 0;const r=n(a(7363));class o extends r.default.PureComponent{render(){const{date:e,isDxMode:t}=this.props,a=t?"DX":"CAFE MiLK";return r.default.createElement("div",{className:"dateAndPlace"},r.default.createElement("div",{className:"date"},e),r.default.createElement("button",{className:"place",onClick:this.props.toggleDxMode},a))}}t.DateAndPlace=o},9256:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JudgementContainer=void 0;const r=n(a(7363)),o=a(5188),s=a(3826),c=a(3526);class l extends r.default.PureComponent{render(){const{nextRank:e,noteJudgements:t,breakDistribution:a,totalJudgements:n,scorePerType:l,combo:i,isDxMode:u,displayMode:d}=this.props;return r.default.createElement("div",{className:"judgementContainer"},r.default.createElement("table",{className:"judgement"},r.default.createElement("tbody",null,r.default.createElement("tr",null,r.default.createElement("th",{className:"rowHead"}," "),r.default.createElement("th",{className:"perfect"},"Perfect"),r.default.createElement("th",{className:"great"},"Great"),r.default.createElement("th",{className:"good"},"Good"),r.default.createElement("th",{className:"miss"},"Miss"),r.default.createElement("th",{className:"score"},"Score")),r.default.createElement(c.NoteJudgement,{noteType:"total",judgements:n,lastColumn:l.get("total"),isDxMode:u}),r.default.createElement(s.NextRankInfo,{nextRank:e,showTitle:"NORMAL"!==d}),i&&r.default.createElement("tr",{className:"maxCombo"},r.default.createElement("th",{className:"noRightBorder",colSpan:4},"MAX COMBO"),r.default.createElement("td",{className:"noLeftBorder",colSpan:2},i)),r.default.createElement("tr",{className:"tableSeparator"},r.default.createElement("td",{colSpan:6})),r.default.createElement(c.NoteJudgement,{noteType:"tap",judgements:t.get("tap"),lastColumn:l.get("tap"),isDxMode:u}),r.default.createElement(c.NoteJudgement,{noteType:"hold",judgements:t.get("hold"),lastColumn:l.get("hold"),isDxMode:u}),r.default.createElement(c.NoteJudgement,{noteType:"slide",judgements:t.get("slide"),lastColumn:l.get("slide"),isDxMode:u}),r.default.createElement(c.NoteJudgement,{noteType:"touch",judgements:t.get("touch"),lastColumn:l.get("touch"),isDxMode:u}),r.default.createElement(o.BreakNoteJudgement,{judgements:t.get("break"),distribution:a,lastColumn:l.get("break"),isDxMode:u,displayMode:d}))))}}t.JudgementContainer=l},3826:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NextRankInfo=void 0;const r=n(a(7363));class o extends r.default.PureComponent{constructor(){super(...arguments),this.state={showTitle:!1}}render(){const{nextRank:e,showTitle:t}=this.props,a=t&&e?e.title:"",n=this.getNextRankDiff();return r.default.createElement("tr",{className:"nextRank"},r.default.createElement("th",{className:"noRightBorder",colSpan:4},"NEXT RANK"),r.default.createElement("td",{className:"noLeftBorder",colSpan:2},a&&r.default.createElement("span",{className:"nextRankTitle"},a),n&&r.default.createElement("span",{className:"nextRankDiff"},n)))}getNextRankDiff(){const{nextRank:e}=this.props;if(!e)return"—————";const{diff:t}=e;return"number"==typeof t?Math.round(t)!==t?t.toFixed(4)+"%":t.toLocaleString("en"):t}}t.NextRankInfo=o},3526:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NoteJudgement=t.getLastColumnText=void 0;const r=n(a(7363)),o=a(6358);function s(e,t){return"string"==typeof e?e:t?(0,o.formatFloat)(e,4)+"%":e.toLocaleString("en")}t.getLastColumnText=s;class c extends r.default.PureComponent{render(){const{noteType:e,judgements:t,lastColumn:a,isDxMode:n}=this.props;if(!t)return null;const o=e.charAt(0).toUpperCase()+e.substring(1),c=a.isMax?"score maxScore":"score",l=function(e){const t=e.cp;return t?t+e.perfect:e.perfect}(t);return r.default.createElement("tr",{className:e+"NoteRow"},r.default.createElement("th",{className:"rowHead"},o),r.default.createElement("td",{className:"perfect"},l),r.default.createElement("td",{className:"great"},t.great),r.default.createElement("td",{className:"good"},t.good),r.default.createElement("td",{className:"miss"},t.miss),r.default.createElement("td",{className:c},s(a.score,n)))}}t.NoteJudgement=c},6381:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PageFooter=void 0;const r=n(a(7363));class o extends r.default.PureComponent{render(){return r.default.createElement("div",{className:"pageFooter"},r.default.createElement("a",{className:"closePage",href:"javascript:window.close()"},"戻る"))}}t.PageFooter=o},7208:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PageTitle=void 0;const r=n(a(7363));class o extends r.default.PureComponent{render(){return r.default.createElement("h3",{className:"pageTitle"},"プレイ履歴")}}t.PageTitle=o},5268:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RootComponent=void 0;const r=n(a(7363)),o=a(8642),s=a(6162),c=a(4518),l=a(5748),i=a(6381),u=a(7208),d=a(1542),m=a(1334),f={date:String(Date.now()),track:"TRACK "+(Math.floor(3*Math.random())+1),songTitle:"分からない",achievement:"95.3035%",highScore:Math.random()>.9?"1":"0",noteDetails:"654-96-31-28\n25-0-0-0\n78-0-0-1\n\n37-2-1-0"};function g(e,t){return t=t||2,e.toString().padStart(t,"0")}function p(e,t,a){return e.get(t)||(console.warn('URL does not contain "'+t+'", using default value "'+a+'"'),a)}function E(e,t=f){const a=p(e,"dt",t.date),n=p(e,"tk",t.track),r=p(e,"df"),s=p(e,"st",t.songTitle),l=p(e,"ac",t.achievement),i=p(e,"hs",t.highScore),u=p(e,"cb"),d=p(e,"nd",t.noteDetails),m=p(e,"sc"),E=(0,o.getDifficultyName)(parseInt(r));return{date:(h=new Date(parseInt(a)),h.getFullYear()+"-"+g(h.getMonth()+1)+"-"+g(h.getDate())+" "+g(h.getHours())+":"+g(h.getMinutes())),track:n,songTitle:s,difficulty:E,syncStatus:m,noteJudgements:(0,c.parseJudgements)(d),combo:u&&u.replace("/"," / "),highScore:"1"===i,achievement:parseFloat(l)};var h}class h extends r.default.PureComponent{constructor(e){super(e),this.referrer=document.referrer&&new URL(document.referrer).origin,this.fetchRankImage=e=>{console.log("fetchRankImage "+e),this.state.rankImg.set(e,null),this.sendMessageToOpener({action:"getRankImage",payload:e})},this.handleWindowMessage=e=>{if((0,s.isMaimaiNetOrigin)(e.origin))switch(this.referrer=e.origin,e.data.action){case"songImage":this.setState({songImg:e.data.imgSrc});break;case"apFcImage":this.setState({apFcImg:URL.createObjectURL(e.data.img)});break;case"syncImage":this.setState({syncImg:URL.createObjectURL(e.data.img)});break;case"rankImage":this.setState((t=>{const a=t.rankImg.get(e.data.title);a&&URL.revokeObjectURL(a);const n=new Map(t.rankImg);return n.set(e.data.title,URL.createObjectURL(e.data.img)),{rankImg:n}}));break;default:console.log(e.data)}};const t=new URLSearchParams(location.search);try{this.state=Object.assign(Object.assign({},E(t)),{rankImg:new Map})}catch(e){console.error(e.message),console.error(e.stack),this.state=Object.assign(Object.assign({},E(new URLSearchParams)),{rankImg:new Map,showError:!0})}}componentDidMount(){document.title=this.state.songTitle+" - maimai classic score layout",window.addEventListener("message",this.handleWindowMessage),this.sendMessageToOpener({action:"ready"})}render(){const{achievement:e,combo:t,date:a,difficulty:n,highScore:o,noteJudgements:s,songTitle:c,track:f,songImg:g,apFcImg:p,rankImg:E,syncImg:h,syncStatus:_,showError:S}=this.state;return r.default.createElement(r.default.Fragment,null,r.default.createElement("div",{className:"widthLimit"},r.default.createElement("div",{className:"container"},r.default.createElement(u.PageTitle,null),r.default.createElement(m.SectionSep,null),S?r.default.createElement("div",{className:"error"},"Failed to parse input. Please contact the developer!"):r.default.createElement(d.ScorePageContainer,{achievement:e,combo:t,date:a,difficulty:n,highScore:o,noteJudgements:s,songTitle:c,track:f,syncStatus:_,songImgSrc:g,apFcImg:p,rankImg:E,syncImg:h,fetchRankImage:this.fetchRankImage}),r.default.createElement(m.SectionSep,null),r.default.createElement(i.PageFooter,null))),r.default.createElement(l.CreditInfo,null))}sendMessageToOpener(e){if(window.opener)if(console.log("sending message to opener",e),this.referrer)window.opener.postMessage(e,this.referrer);else for(const t of s.MAIMAI_NET_ORIGINS)window.opener.postMessage(e,t)}}t.RootComponent=h},3145:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ScorePage=void 0;const s=o(a(7363)),c=a(134),l=a(6358),i=a(7991),u=a(7889),d=a(8625),m=a(9256),f=a(8330),g=a(4639);function p(e,t){return t?"-"+(0,l.formatFloat)(e,t)+"%":"-"+e.toLocaleString("en")}function E(e,t){const a=e?t.achievement:t.finaleAchievement;if(e){if(101===a)return;if(a>=100.5)return{title:"AP+",diff:101-a};const e=(0,i.getRankDefinitions)()[(0,i.getRankIndexByAchievement)(a)-1];return{title:e.title,diff:e.minAchv-a}}let n;return t.finaleBorder.forEach(((e,t)=>{e>0&&!n&&(n={title:t,diff:e})})),n}t.ScorePage=e=>{const{achievement:t,apFcImg:a,rankImg:n,syncImg:r,highScore:o,date:l,songTitle:i,track:h,difficulty:_,songImgSrc:S,noteJudgements:M,combo:v,syncStatus:R,apFcStatus:I,finaleAchievement:N,maxFinaleScore:A,breakDistribution:P,totalJudgements:O,playerScorePerType:L}=e,T=new URLSearchParams(window.location.search).get("gameVersion"),b=(0,c.validateGameVersion)(T,0),[y,k]=(0,s.useState)(b>=13),[x,D]=(0,s.useState)("LOSS"),B=function(e,t,a){if("LOSS"===t){const t=e?a.dx:a.finale,n=e?2:0,r=new Map;return t.forEach(((e,t)=>{r.set(t,{perfect:p(e.perfect,n),great:p(e.great,n),good:p(e.good,n),miss:p(e.miss,n)})})),r}}(y,x,e.achvLossDetail),C=function(e,t,a){const n=e?a.achvLossDetail.dx:a.achvLossDetail.finale;if("LOSS"===t){const t=e?4:0,a=new Map;return n.forEach(((e,n)=>{const r=0===e.total,o=p(e.total,t);a.set(n,{isMax:r,score:o})})),a}return e?a.dxAchvPerType:a.playerScorePerType}(y,x,e);return s.default.createElement("div",{className:"songScoreContainer"},s.default.createElement(d.DateAndPlace,{date:l,isDxMode:y,toggleDxMode:()=>{k(!y)}}),s.default.createElement("div",{className:"songScoreBody"},s.default.createElement("hr",{className:"trackTopLine"}),s.default.createElement(g.SongInfo,{songTitle:i,track:h,difficulty:_}),s.default.createElement(f.SongImg,{imgSrc:S}),s.default.createElement(u.AchievementInfo,{apFcStatus:I,apFcImg:a,rankImgMap:n,syncStatus:R,syncImg:r,isDxMode:y,isHighScore:o,dxAchv:t,finaleAchv:N,maxFinaleAchv:A,showMaxAchv:"NORMAL"!==x,toggleDisplayMode:()=>{D(function(e){switch(e){case"NORMAL":return"LOSS";case"LOSS":return"DETAIL";default:return"NORMAL"}}(x))},fetchRankImage:e.fetchRankImage}),s.default.createElement(m.JudgementContainer,{noteJudgements:B||M,breakDistribution:P,totalJudgements:B?B.get("total"):O,scorePerType:C||L,nextRank:E(y,e),combo:v,isDxMode:y,displayMode:x})))}},1542:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScorePageContainer=void 0;const r=n(a(7363)),o=a(7575),s=a(3145);class c extends r.default.PureComponent{static getDerivedStateFromProps(e){const t=(0,o.calculateScoreInfo)(e.noteJudgements,e.achievement),a=function(e){const t={perfect:0,great:0,good:0,miss:0};return e.forEach((e=>{Object.keys(e).forEach((a=>{let n=a;const r=e[n];"cp"===n&&(n="perfect"),t[n]+=r}))})),t}(e.noteJudgements),n=function(e,t){return e.miss?null:0===t.get("AP+")?"AP+":e.good?"FC":e.great?"FC+":"AP"}(a,t.finaleBorder);return Object.assign(Object.assign({},t),{totalJudgements:a,apFcStatus:n})}render(){return r.default.createElement(s.ScorePage,Object.assign({},this.props,this.state))}}t.ScorePageContainer=c},1334:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SectionSep=void 0;const r=n(a(7363));class o extends r.default.PureComponent{render(){return r.default.createElement("div",{className:"pageSectionSeparator"})}}t.SectionSep=o},8330:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SongImg=void 0;const r=n(a(7363));class o extends r.default.PureComponent{render(){const{imgSrc:e}=this.props;return r.default.createElement("div",{className:"songImgContainer"},e?r.default.createElement("img",{className:"songImg",src:e,alt:""}):r.default.createElement("div",{className:"songImg songImgPlaceholder"}),r.default.createElement("div",{className:"songImgReflecContainer"},this.getReflecElement(e)))}getReflecElement(e){if(e){const t={backgroundImage:`url("${e}")`};return r.default.createElement("div",{className:"songImgReflec",style:t})}return r.default.createElement("div",{className:"songImgPlaceholder songImgReflecPlaceholder"})}}t.SongImg=o},4639:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SongInfo=void 0;const r=n(a(7363)),o=a(7627),s=r.default.memo((e=>{const{difficulty:t}=e;if(!t)return null;const a=t.toLowerCase().replace(":","");return r.default.createElement("span",{className:"difficulty "+a},"【",r.default.createElement("span",{id:"difficulty"},t),"】")}));class c extends r.default.PureComponent{render(){const{songTitle:e,track:t,difficulty:a}=this.props;return r.default.createElement("div",{className:"songInfoContainer"},r.default.createElement("div",null,r.default.createElement("span",{className:"track",id:"track"},t),r.default.createElement(s,{difficulty:a})),r.default.createElement("h2",{className:"songTitle",id:"songTitle"},r.default.createElement("a",{className:"songWikiLink",href:(0,o.getZhWikiLink)(e),target:"_blank"},e)))}}t.SongInfo=c},1782:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EMPTY_JUDGEMENT_OBJ=t.BREAK_BONUS_MULTIPLIER=t.BREAK_BASE_SCORE_MULTIPLIER=t.MAX_BREAK_POINTS=t.BREAK_BONUS_POINTS=t.REGULAR_BASE_SCORE_MULTIPLIER=t.BASE_SCORE_PER_TYPE=t.DX_NOTE_TYPES=void 0,t.DX_NOTE_TYPES=["tap","hold","slide","touch","break"],t.BASE_SCORE_PER_TYPE={tap:500,hold:1e3,touch:500,slide:1500,break:2500},t.REGULAR_BASE_SCORE_MULTIPLIER={cp:1,perfect:1,great:.8,good:.5,miss:0},t.BREAK_BONUS_POINTS=100,t.MAX_BREAK_POINTS=t.BASE_SCORE_PER_TYPE.break+t.BREAK_BONUS_POINTS,t.BREAK_BASE_SCORE_MULTIPLIER=new Map([[t.MAX_BREAK_POINTS,1],[2550,1],[2500,1],[2e3,.8],[1500,.6],[1250,.5],[1e3,.4],[0,0]]),t.BREAK_BONUS_MULTIPLIER=new Map([[t.MAX_BREAK_POINTS,1],[2550,.75],[2500,.5],[2e3,.4],[1500,.4],[1250,.4],[1e3,.3],[0,0]]),t.EMPTY_JUDGEMENT_OBJ={perfect:0,great:0,good:0,miss:0}},7504:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertJudgementsToArray=void 0,t.convertJudgementsToArray=function(e){return"number"==typeof e.cp?[e.cp,e.perfect,e.great,e.good,e.miss]:[e.perfect,e.great,e.good,e.miss]}},1309:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(a(7363)),o=n(a(1533)),s=a(5268);o.default.render(r.default.createElement(s.RootComponent,null),document.getElementById("root"))},4518:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseJudgements=void 0;const a={cp:0,perfect:0,great:0,good:0,miss:0};function n(e,t){const a=e.match(/\d+/g);if(!a)return t;if(a.length<4)throw new Error("Cannot parse note judgements");const n=a.map((e=>parseInt(e,10)));return n.length>4?{cp:n[0],perfect:n[1],great:n[2],good:n[3],miss:n[4]}:{perfect:n[0],great:n[1],good:n[2],miss:n[3]}}t.parseJudgements=function(e){let t=e.split("_");if(1===t.length&&(t=e.split("\n")),t.length<4)throw new Error("Cannot parse note judgement lines");const r=new Map,o=n(t.pop(),a);r.set("break",o);const s=n(t.pop(),void 0);s&&r.set("touch",s);const c=n(t.pop(),a);r.set("slide",c);const l=n(t.pop(),a);r.set("hold",l);const i=n(t.pop(),a);return r.set("tap",i),r}},7575:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculateScoreInfo=void 0;const n=a(6358),r=a(7980),o=a(7616),s=a(1782),c=a(7504);function l(e,t,a,r){if("SSS+"===a)return e+t*s.BREAK_BONUS_POINTS-r;const o=e*a-r;return o<0?-1:(0,n.roundFloat)(o,"ceil",50)}t.calculateScoreInfo=function(e,t){let a=0,i=0;const u=new Map([["tap",{score:0,isMax:!1}],["hold",{score:0,isMax:!1}],["slide",{score:0,isMax:!1}],["touch",{score:0,isMax:!1}],["break",{score:0,isMax:!1}],["total",{score:0,isMax:!1}]]),d=new Map;e.forEach(((e,t)=>{const r=s.BASE_SCORE_PER_TYPE[t],o=(0,n.sum)(Object.values(e))*r;if(a+=o,"break"!==t){let a=0;Object.keys(e).forEach((t=>{const n=t,o=e[n];a+=o*r*s.REGULAR_BASE_SCORE_MULTIPLIER[n]}));const n=o-a;u.set(t,{score:a,isMax:0===n}),d.set(t,n),i+=a}}));const m=a/100,f=t-i/m,g=s.BASE_SCORE_PER_TYPE.break/m,p=[],E=e.get("break");(0,o.walkBreakDistributions)(p,new Map,(0,c.convertJudgementsToArray)(E),f,g),console.log("valid break distributions",p);let h=p[0];h||(console.warn("Could not find a valid break distribution!"),console.warn("Please report the issue to the developer."),h=new Map([[s.MAX_BREAK_POINTS,E.cp||0],[2550,0],[2500,E.perfect],[2e3,0],[1500,0],[1250,E.great],[1e3,E.good],[0,E.miss]]));let _=0,S=0;h.forEach(((e,t)=>{_+=e,S+=e*t})),u.set("break",{score:S,isMax:_===h.get(2600)});const M=i+S,v=a+s.BREAK_BONUS_POINTS*_;u.set("total",{score:M,isMax:M===v});const R=(0,n.roundFloat)(M/m,"floor",.01),I=(0,n.roundFloat)(v/m,"floor",.01);console.log("player score per note type",u);const N=new Map;N.set("tap",{score:(0,n.roundFloat)(u.get("tap").score/m,"round",1e-4),isMax:u.get("tap").isMax}),N.set("hold",{score:(0,n.roundFloat)(u.get("hold").score/m,"round",1e-4),isMax:u.get("hold").isMax}),N.set("slide",{score:(0,n.roundFloat)(u.get("slide").score/m,"round",1e-4),isMax:u.get("slide").isMax}),N.set("touch",{score:(0,n.roundFloat)(u.get("touch").score/m,"round",1e-4),isMax:u.get("touch").isMax}),N.set("break",{score:(0,n.roundFloat)(f,"round",1e-4),isMax:u.get("break").isMax}),N.set("total",{score:(0,n.roundFloat)(t,"round",1e-4),isMax:u.get("total").isMax});const A=(0,r.calculateAchvLoss)(e,h,m);console.log("achievement loss detail",A);const P=new Map([["S",l(a,_,.97,M)],["S+",l(a,_,.98,M)],["SS",l(a,_,.99,M)],["SS+",l(a,_,.995,M)],["SSS",l(a,_,1,M)],["SSS+",l(a,_,"SSS+",M)]]),O=new Map,L=500/m,T=1/_;return O.set("tap",L),O.set("hold",2*L),O.set("slide",3*L),O.set("touch",L),O.set("breakDx",5*L+T),O.set("break",5.2*L),{finaleAchievement:R,maxFinaleScore:I,breakDistribution:h,achvLossDetail:A,finaleBorder:P,pctPerNoteType:O,playerScorePerType:u,dxAchvPerType:N}}},8642:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDifficultyTextColor=t.getDifficultyForRecord=t.getDifficultyByName=t.getDifficultyName=t.DIFFICULTY_CLASSNAME_MAP=t.DIFFICULTIES=void 0,t.DIFFICULTIES=[0,1,2,3,4];const a=["BASIC","ADVANCED","EXPERT","MASTER","Re:MASTER"];function n(e){const t=a.indexOf(e.toUpperCase());return t<0?4:t}t.DIFFICULTY_CLASSNAME_MAP=new Map([[0,"basic"],[1,"advanced"],[2,"expert"],[3,"master"],[4,"remaster"]]),t.getDifficultyName=function(e){return a[e]},t.getDifficultyByName=n,t.getDifficultyForRecord=function(e){const t=e.querySelector(".playlog_top_container img.playlog_diff").src;return n(t.substring(t.lastIndexOf("_")+1,t.lastIndexOf(".")))},t.getDifficultyTextColor=function(e){return["#45c124","#ffba01","#ff7b7b","#9f51dc","#dbaaff"][e]}},6162:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getGameRegionFromOrigin=t.isMaimaiNetOrigin=t.MAIMAI_NET_ORIGINS=void 0,t.MAIMAI_NET_ORIGINS=["https://maimaidx.jp","https://maimaidx-eng.com"],t.isMaimaiNetOrigin=function(e){return"https://maimaidx.jp"===e||"https://maimaidx-eng.com"===e},t.getGameRegionFromOrigin=function(e){return"https://maimaidx.jp"===e?"https://maimaidx.jp":"https://maimaidx-eng.com"}},134:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getVersionName=t.validateGameVersion=t.RATING_CALCULATOR_SUPPORTED_VERSIONS=t.LATEST_VERSION=void 0;const a=["maimai","maimai PLUS","GreeN","GreeN PLUS","ORANGE","ORANGE PLUS","PiNK","PiNK PLUS","MURASAKi","MURASAKi PLUS","MiLK","MiLK PLUS","FiNALE","maimaiでらっくす","maimaiでらっくす PLUS","Splash","Splash PLUS","UNiVERSE","UNiVERSE PLUS","FESTiVAL","FESTiVAL PLUS"];t.LATEST_VERSION=20,t.RATING_CALCULATOR_SUPPORTED_VERSIONS=[18,19,20],t.validateGameVersion=function(e,a,n=t.LATEST_VERSION){const r="string"==typeof e?parseInt(e):e;return!e||isNaN(r)?n:r>=a&&r<=n?r:n},t.getVersionName=function(e){return a[e]}},9268:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDisplayLv=t.getDefaultLevel=t.getOfficialLevel=t.MAX_LEVEL=void 0,t.MAX_LEVEL=15,t.getOfficialLevel=function(e){const t=Math.floor(e);return e-t>.6?t+"+":t.toString()},t.getDefaultLevel=function(e){if(!e)return 1;const t=parseInt(e);return e.endsWith("+")?t+.7:t},t.getDisplayLv=function(e,t=!1){return(t=t||e<0)?Math.abs(e).toFixed(1)+"~":e.toFixed(1)}},6358:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatFloat=t.roundFloat=t.sum=t.compareNumber=void 0,t.compareNumber=function(e,t){return e>t?1:e<t?-1:0},t.sum=function(e){let t=0;for(const a of e)t+=a;return t},t.roundFloat=function(e,t,a){return Math[t](e/a)*a},t.formatFloat=function(e,t){return e?e.toFixed(t):"0"}},7991:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calcRecommendedLv=t.getFinaleRankTitle=t.getRankTitle=t.getRankByAchievement=t.getRankIndexByAchievement=t.getRankDefinitions=t.SSSPLUS_MIN_ACHIEVEMENT=void 0;const n=a(9268),r=a(6358);t.SSSPLUS_MIN_ACHIEVEMENT=100.5;const o=[{minAchv:100.5,factor:22.4,title:"SSS+"},{minAchv:100,factor:21.6,title:"SSS"},{minAchv:99.5,factor:21.1,title:"SS+"},{minAchv:99,factor:20.8,title:"SS"},{minAchv:98,factor:20.3,title:"S+"},{minAchv:97,factor:20,title:"S"},{minAchv:94,factor:16.8,title:"AAA"},{minAchv:90,factor:15.2,title:"AA"},{minAchv:80,factor:13.6,title:"A"},{minAchv:75,factor:12,title:"BBB"},{minAchv:70,factor:11.2,title:"BB"},{minAchv:60,factor:9.6,title:"B"},{minAchv:50,factor:8,title:"C"}];function s(){return o}function c(e){return o.findIndex((t=>e>=t.minAchv))}function l(e){const t=c(e);return t<0?"D":o[t].title}t.getRankDefinitions=s,t.getRankIndexByAchievement=c,t.getRankByAchievement=function(e){const t=c(e);return t<0?null:s()[t]},t.getRankTitle=l,t.getFinaleRankTitle=function(e){return l(e).replace("SSS+","SSS")},t.calcRecommendedLv=function(e,t){const a=(0,r.roundFloat)(100*e/t.factor/t.minAchv,"ceil",.1);return a>n.MAX_LEVEL?-1:a}},7627:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getZhWikiLink=void 0,t.getZhWikiLink=function(e){return"https://maimai.fandom.com/zh/wiki/"+encodeURIComponent(e)+"?variant=zh-hant"}},7363:e=>{e.exports=React},1533:e=>{e.exports=ReactDOM}},t={};!function a(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,a),o.exports}(1309)})();